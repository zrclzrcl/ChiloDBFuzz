CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name VARCHAR,
    price DECIMAL(10, 2),
    category VARCHAR
);

CREATE TABLE customers (
    customer_id INTEGER PRIMARY KEY,
    name VARCHAR,
    email VARCHAR UNIQUE
);

CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date DATE
);

CREATE TABLE order_items (
    order_item_id INTEGER PRIMARY KEY,
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER,
    price DECIMAL(10, 2)
);

-- Insert some sample data
INSERT INTO products (name, price, category) VALUES
('Laptop', 1200.00, 'Electronics'),
('Mouse', 25.00, 'Electronics'),
('Keyboard', 75.00, 'Electronics'),
('T-Shirt', 20.00, 'Clothing'),
('Jeans', 60.00, 'Clothing');

INSERT INTO customers (name, email) VALUES
('Alice', 'alice@example.com'),
('Bob', 'bob@example.com');

INSERT INTO orders (customer_id, order_date) VALUES
(1, '2023-10-26'),
(2, '2023-10-27');

INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 1, 1200.00),
(1, 2, 1, 25.00),
(2, 4, 2, 20.00);

-- Perform some queries
SELECT * FROM products WHERE price > 50.00;
SELECT c.name, COUNT(o.order_id) AS order_count FROM customers c LEFT JOIN orders o ON c.customer_id = o.customer_id GROUP BY c.customer_id;
SELECT p.name, SUM(oi.quantity) AS total_quantity FROM products p INNER JOIN order_items oi ON p.id = oi.product_id GROUP BY p.id ORDER BY total_quantity DESC;

-- DuckDB Specific features
SELECT APPROX_COUNT_DISTINCT(category) FROM products;
SELECT CURRENT_TIMESTAMP();
SELECT last_day(order_date) from orders;

-- Demonstrate window functions
SELECT
    product_id,
    quantity,
    RANK() OVER (ORDER BY quantity DESC) as rank_order
FROM
    order_items;

SELECT typeof(1);
SELECT typeof('string');