CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    product_name VARCHAR(255),
    price DECIMAL(10, 2),
    category VARCHAR(50)
);

INSERT INTO products (product_name, price, category) VALUES
('Laptop', 1200.00, 'Electronics'),
('Keyboard', 75.00, 'Electronics'),
('Mouse', 25.00, 'Electronics'),
('Book', 20.00, 'Books'),
('T-Shirt', 30.00, 'Clothing');

CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER,
    product_id INTEGER,
    quantity INTEGER,
    order_date DATE
);

INSERT INTO orders (customer_id, product_id, quantity, order_date) VALUES
(1, 1, 1, '2023-01-15'),
(1, 3, 2, '2023-01-15'),
(2, 2, 1, '2023-02-01'),
(3, 4, 3, '2023-02-20'),
(3, 5, 1, '2023-03-10');

SELECT category, AVG(price) AS average_price FROM products GROUP BY category;

SELECT product_name, price FROM products WHERE price > (SELECT AVG(price) FROM products);

SELECT o.order_id, p.product_name, o.quantity, o.order_date
FROM orders o
JOIN products p ON o.product_id = p.product_id
WHERE o.order_date BETWEEN '2023-01-01' AND '2023-02-28';

-- Demonstrate DuckDB specific functionality: APPROXIMATE COUNT DISTINCT
SELECT APPROXIMATE COUNT(DISTINCT customer_id) FROM orders;

-- Demonstrate DuckDB specific functionality: JSON support
CREATE TABLE json_data (
    id INTEGER,
    data JSON
);

INSERT INTO json_data VALUES (1, '{"name": "John", "age": 30, "city": "New York"}');
SELECT data -> 'age' FROM json_data;

--Test unnesting
CREATE TABLE items (list INTEGER[]);
INSERT INTO items VALUES ([1, 2, 3]);
SELECT UNNEST(list) FROM items;