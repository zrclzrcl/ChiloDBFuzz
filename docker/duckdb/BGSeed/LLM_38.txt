CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2)
);

INSERT INTO products (name, price) VALUES
('Laptop', 1200.00),
('Mouse', 25.00),
('Keyboard', 75.00),
('Monitor', 300.00);

CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER,
    order_date DATE
);

INSERT INTO orders (customer_id, order_date) VALUES
(1, '2023-01-15'),
(2, '2023-02-20'),
(1, '2023-03-10');

CREATE TABLE order_items (
    order_item_id INTEGER PRIMARY KEY,
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER
);

INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 1),
(1, 2, 2),
(2, 3, 1),
(3, 4, 1);

-- DuckDB-specific feature: APPROXIMATE COUNT DISTINCT
SELECT APPROXIMATE COUNT(DISTINCT customer_id) FROM orders;

-- Test case sensitivity and aliases
select Name AS ProductName from products where productname like 'L%';

-- Test aggregate functions and grouping
SELECT product_id, SUM(quantity) AS total_quantity FROM order_items GROUP BY product_id ORDER BY total_quantity DESC;

-- Test JOIN operations
SELECT o.order_id, p.name, oi.quantity FROM orders o JOIN order_items oi ON o.order_id = oi.order_id JOIN products p ON oi.product_id = p.id;

-- Test CASE WHEN statements
SELECT name, price, CASE WHEN price > 100 THEN 'Expensive' ELSE 'Cheap' END AS price_category FROM products;

-- Test String operations
SELECT name, UPPER(name), SUBSTR(name, 1, 3) FROM products;

-- Test Date/Time operations (using CURRENT_DATE and INTERVAL)
SELECT order_date, DATE_ADD(order_date, INTERVAL '1 month') FROM orders;

-- Test NULL handling with COALESCE
CREATE TABLE null_test (id INTEGER, value INTEGER);
INSERT INTO null_test VALUES (1, NULL), (2, 10);
SELECT id, COALESCE(value, 0) FROM null_test;

-- Test UNNEST (DuckDB specific list/array functionality)
CREATE TABLE list_test (id INTEGER, my_list INTEGER[]);
INSERT INTO list_test VALUES (1, [1, 2, 3]), (2, [4, 5]);
SELECT id, UNNEST(my_list) FROM list_test;

-- Test JSON functionality
CREATE TABLE json_test (id INTEGER, data JSON);
INSERT INTO json_test VALUES (1, JSON('{"name": "John", "age": 30}')), (2, JSON('{"name": "Jane", "age": 25}'));
SELECT id, data -> 'name' FROM json_test;