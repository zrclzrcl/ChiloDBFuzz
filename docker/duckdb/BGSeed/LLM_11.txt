CREATE TABLE sensor_data (
    sensor_id INTEGER,
    timestamp TIMESTAMP,
    temperature DOUBLE,
    humidity DOUBLE,
    location VARCHAR
);

CREATE INDEX sensor_id_idx ON sensor_data (sensor_id);

INSERT INTO sensor_data VALUES (1, '2024-01-01 00:00:00', 25.5, 60.2, 'Living Room');
INSERT INTO sensor_data VALUES (1, '2024-01-01 00:05:00', 25.6, 60.1, 'Living Room');
INSERT INTO sensor_data VALUES (2, '2024-01-01 00:00:00', 22.0, 55.0, 'Bedroom');

-- Add a generated column
ALTER TABLE sensor_data ADD COLUMN temp_celsius DOUBLE AS (temperature - 32) * 5/9;

-- Test window functions
SELECT sensor_id, timestamp, temperature,
       AVG(temperature) OVER (PARTITION BY sensor_id ORDER BY timestamp ASC ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) as avg_temp
FROM sensor_data;

-- Test unnesting an array
CREATE TABLE array_test (id INTEGER, vals INTEGER[]);
INSERT INTO array_test VALUES (1, [1, 2, 3]);
SELECT id, val FROM array_test, UNNEST(vals) AS val;

-- Test JSON functionality
CREATE TABLE json_test (id INTEGER, data JSON);
INSERT INTO json_test VALUES (1, JSON('{"name": "John", "age": 30}'));
SELECT id, json_extract_string(data, '$.name') FROM json_test;

-- Test DuckDB-specific function: pragma_table_info
PRAGMA table_info('sensor_data');