CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name VARCHAR,
    price DECIMAL(10, 2),
    category VARCHAR,
    discount REAL
);

CREATE TABLE customers (
    customer_id INTEGER PRIMARY KEY,
    name VARCHAR,
    email VARCHAR UNIQUE,
    join_date DATE DEFAULT CURRENT_DATE
);

CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date TIMESTAMP,
    total_amount DECIMAL(10, 2)
);

CREATE TABLE order_items (
    order_item_id INTEGER PRIMARY KEY,
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER,
    price DECIMAL(10, 2)
);

-- Insert some sample data
INSERT INTO products (id, name, price, category, discount) VALUES
(1, 'Laptop', 1200.00, 'Electronics', 0.1),
(2, 'Mouse', 25.00, 'Electronics', NULL),
(3, 'T-Shirt', 20.00, 'Apparel', 0.05),
(4, 'Book', 15.00, 'Books', 0.0),
(5, 'Headphones', 100.00, 'Electronics', 0.0);

INSERT INTO customers (customer_id, name, email) VALUES
(1, 'Alice', 'alice@example.com'),
(2, 'Bob', 'bob@example.com'),
(3, 'Charlie', 'charlie@example.com');

INSERT INTO orders (order_id, customer_id, order_date, total_amount) VALUES
(101, 1, '2023-11-01 10:00:00', 1200.00),
(102, 2, '2023-11-05 14:30:00', 45.00),
(103, 1, '2023-11-10 16:00:00', 35.00);

INSERT INTO order_items (order_item_id, order_id, product_id, quantity, price) VALUES
(1, 101, 1, 1, 1200.00),
(2, 102, 2, 1, 25.00),
(3, 102, 3, 1, 20.00),
(4, 103, 3, 1, 20.00),
(5, 103, 4, 1, 15.00);

-- Test queries
SELECT category, AVG(price) AS average_price FROM products GROUP BY category;
SELECT name FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT c.name, COUNT(o.order_id) AS order_count FROM customers c LEFT JOIN orders o ON c.customer_id = o.customer_id GROUP BY c.name ORDER BY order_count DESC;
SELECT p.name, SUM(oi.quantity) AS total_quantity FROM products p JOIN order_items oi ON p.id = oi.product_id GROUP BY p.name ORDER BY total_quantity DESC;
SELECT name, price, discount, price * (1 - COALESCE(discount, 0)) AS discounted_price FROM products;
SELECT * FROM orders WHERE order_date BETWEEN '2023-11-01' AND '2023-11-15';
SELECT customer_id, STRFTIME('%Y-%m', order_date) AS order_month, COUNT(*) FROM orders GROUP BY customer_id, order_month;
SELECT name, category FROM products WHERE category LIKE '%Elect%';
SELECT name, price FROM products ORDER BY price DESC LIMIT 3;
SELECT category, sum(price) OVER (ORDER BY price) from products;

-- DuckDB specific features
SELECT APPROX_COUNT_DISTINCT(customer_id) FROM orders;
COPY products FROM 'products.csv' (DELIMITER ',', HEADER); -- Assuming products.csv exists in fuzzing environment.
SELECT SUM(price) FILTER (WHERE category = 'Electronics') FROM products;
SELECT id, name, LIST_VALUE(1, 2, 3, id) AS my_list FROM products LIMIT 1;
PRAGMA show_tables;
CREATE VIEW expensive_products AS SELECT * FROM products WHERE price > 500;
SELECT * FROM expensive_products;