CREATE TABLESPACE my_tablespace LOCATION '/tmp/my_tablespace';

CREATE COLLATION german (locale = 'de_DE');

CREATE UNLOGGED TABLE unlogged_table (
    id SERIAL PRIMARY KEY,
    data TEXT
);

CREATE DOMAIN posint AS INTEGER CHECK (VALUE > 0);

CREATE TYPE inventory_item AS (
    name text,
    supplier_id integer,
    price numeric
);

CREATE TABLE products (
    product_no integer UNIQUE NOT NULL,
    name text,
    price numeric CHECK (price > 0),
    description jsonb,
    inventory inventory_item
);

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    product_no integer REFERENCES products (product_no),
    quantity integer,
    order_date date DEFAULT CURRENT_DATE
);

INSERT INTO products (product_no, name, price, description) VALUES
    (1, 'Cheese', 9.99, '{"origin": "France", "type": "Brie"}'),
    (2, 'Bread', 2.50, '{"type": "Sourdough"}'),
    (3, 'Milk', 3.00, '{"type": "Whole"}');

INSERT INTO orders (product_no, quantity) VALUES
    (1, 2),
    (2, 1),
    (3, 3);

SELECT * FROM products WHERE price > 5.00;

UPDATE products SET price = price * 1.10 WHERE product_no = 1;

DELETE FROM orders WHERE quantity < 2;

ALTER TABLE products ADD COLUMN weight numeric;

ALTER TABLE products ALTER COLUMN weight TYPE float;

CREATE INDEX idx_product_name ON products (name);

CREATE VIEW product_summary AS
SELECT name, price FROM products;

SELECT * FROM product_summary WHERE price < 10;

CREATE FUNCTION add_one(i INTEGER) RETURNS INTEGER AS $$
        BEGIN
                RETURN i + 1;
        END;
$$ LANGUAGE plpgsql;

SELECT add_one(5);

CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    salary NUMERIC,
    start_date DATE,
    end_date DATE GENERATED ALWAYS AS (start_date + INTERVAL '1 year') STORED
);

INSERT INTO employees (name, salary, start_date) VALUES ('Alice', 50000, '2023-01-01');

SELECT * FROM employees;

CREATE TABLE range_test (
  tsrange tsrange,
  intrange int4range
);

INSERT INTO range_test VALUES (tsrange('2024-01-01 00:00:00', '2024-01-02 00:00:00'), int4range(10,20));

SELECT * FROM range_test WHERE tsrange && tsrange('2024-01-01 12:00:00', '2024-01-03 00:00:00');

CREATE TABLE with_ordinality_test (value text);
INSERT INTO with_ordinality_test VALUES ('a'), ('b'), ('c');
SELECT value, ordinality FROM with_ordinality_test WITH ORDINALITY;

SECURITY LABEL FOR pg_class ON products IS 'sensitive data';

DROP VIEW product_summary;
DROP TABLE orders;
DROP TABLE products;
DROP TABLE employees;
DROP TABLE range_test;
DROP TABLE with_ordinality_test;
DROP FUNCTION add_one(INTEGER);
DROP TABLESPACE my_tablespace;
DROP COLLATION german;
DROP DOMAIN posint;
DROP TYPE inventory_item;
DROP TABLE unlogged_table;