CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(50) NOT NULL,
    price DECIMAL(10, 2)
);

CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    email VARCHAR(100) UNIQUE
);

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INT REFERENCES customers(customer_id),
    order_date DATE DEFAULT CURRENT_DATE
);

CREATE TABLE order_items (
    order_item_id SERIAL PRIMARY KEY,
    order_id INT REFERENCES orders(order_id),
    product_id INT REFERENCES products(product_id),
    quantity INT
);

INSERT INTO products (product_name, price) VALUES
('Laptop', 1200.00),
('Mouse', 25.00),
('Keyboard', 75.00),
('Monitor', 300.00);

INSERT INTO customers (first_name, last_name, email) VALUES
('John', 'Doe', 'john.doe@example.com'),
('Jane', 'Smith', 'jane.smith@example.com');

INSERT INTO orders (customer_id) VALUES
(1),
(2);

INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 1),
(1, 2, 1),
(2, 3, 2),
(2, 4, 1);

SELECT * FROM products WHERE price > 50.00;

SELECT c.first_name, c.last_name, o.order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id;

UPDATE products SET price = 1250.00 WHERE product_name = 'Laptop';

DELETE FROM products WHERE product_name = 'Mouse';

CREATE INDEX idx_customer_email ON customers (email);

EXPLAIN SELECT * FROM products WHERE product_name LIKE 'L%';

-- PostgreSQL-specific features
CREATE OR REPLACE FUNCTION get_product_price(product_name VARCHAR)
RETURNS DECIMAL AS $$
BEGIN
  RETURN (SELECT price FROM products WHERE product_name = get_product_price.product_name);
END;
$$ LANGUAGE plpgsql;

SELECT get_product_price('Laptop');

CREATE TYPE inventory_status AS ENUM ('in_stock', 'out_of_stock', 'backordered');

ALTER TABLE products ADD COLUMN status inventory_status;

UPDATE products SET status = 'in_stock' WHERE product_id IN (1,3,4);
UPDATE products SET status = 'out_of_stock' WHERE product_id = 2;

SELECT product_name, status FROM products;

CREATE TABLE logs (
    log_id SERIAL PRIMARY KEY,
    log_message TEXT,
    log_time TIMESTAMPTZ DEFAULT now()
);

CREATE TRIGGER log_products_update
AFTER UPDATE ON products
FOR EACH ROW
EXECUTE FUNCTION log_products_update_func();

CREATE OR REPLACE FUNCTION log_products_update_func()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO logs (log_message)
    VALUES (format('Product %s updated: price changed from %s to %s',
                   OLD.product_name, OLD.price, NEW.price));
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

UPDATE products SET price = 1300.00 WHERE product_name = 'Laptop';

SELECT * FROM logs;

DROP TRIGGER log_products_update ON products;
DROP FUNCTION log_products_update_func();
DROP TABLE logs;
DROP FUNCTION get_product_price(varchar);
DROP TYPE inventory_status;
DROP INDEX idx_customer_email;
DROP TABLE order_items;
DROP TABLE orders;
DROP TABLE customers;
DROP TABLE products;