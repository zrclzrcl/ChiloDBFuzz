CREATE TABLE employee (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    age INTEGER,
    salary NUMERIC(10, 2),
    hire_date DATE,
    department VARCHAR(50)
);

CREATE INDEX idx_employee_name ON employee (name);

INSERT INTO employee (name, age, salary, hire_date, department) VALUES
('Alice Smith', 30, 60000.00, '2020-01-15', 'Sales'),
('Bob Johnson', 25, 50000.00, '2021-05-20', 'Marketing'),
('Charlie Brown', 35, 70000.00, '2019-03-10', 'Engineering'),
('David Lee', 28, 55000.00, '2022-09-01', 'Sales'),
('Eve Wilson', 40, 80000.00, '2018-07-05', 'Management');

SELECT * FROM employee WHERE age > 27 AND salary < 75000.00;

UPDATE employee SET salary = salary * 1.10 WHERE department = 'Sales';

DELETE FROM employee WHERE id = 4;

ALTER TABLE employee ADD COLUMN email VARCHAR(100);

UPDATE employee SET email = LOWER(REPLACE(name, ' ', '.')) || '@example.com';

SELECT AVG(age) AS average_age, MAX(salary) AS max_salary FROM employee;

SELECT department, COUNT(*) AS employee_count FROM employee GROUP BY department;

SELECT name, hire_date FROM employee ORDER BY hire_date DESC LIMIT 2;

CREATE VIEW sales_employees AS SELECT name, salary FROM employee WHERE department = 'Sales';

SELECT * FROM sales_employees;

DROP VIEW sales_employees;

-- Example using a PostgreSQL-specific feature: JSON support
ALTER TABLE employee ADD COLUMN details JSONB;

UPDATE employee SET details = '{"title": "Software Engineer", "skills": ["Java", "Python"]}'::jsonb WHERE name = 'Charlie Brown';

SELECT name, details -> 'title' AS title FROM employee WHERE details IS NOT NULL;

-- Example using generate_series
SELECT generate_series(1, 5);

-- Example using window functions
SELECT name, salary, RANK() OVER (ORDER BY salary DESC) AS salary_rank FROM employee;

-- Example using common table expression (CTE)
WITH DepartmentAverages AS (
  SELECT department, AVG(salary) AS avg_salary
  FROM employee
  GROUP BY department
)
SELECT e.name, e.department, e.salary, da.avg_salary
FROM employee e
JOIN DepartmentAverages da ON e.department = da.department
WHERE e.salary > da.avg_salary;

-- Example of using pg_sleep
SELECT pg_sleep(0.1);

-- Example of using unnest with array
SELECT unnest(ARRAY['Alice', 'Bob', 'Charlie']);

-- Adding constraints
ALTER TABLE employee ADD CONSTRAINT check_age CHECK (age > 18);