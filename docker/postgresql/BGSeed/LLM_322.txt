CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50),
    email VARCHAR(100) UNIQUE,
    hire_date DATE,
    job_id INTEGER,
    salary DECIMAL(10, 2),
    department_id INTEGER
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    location VARCHAR(50)
);

ALTER TABLE employees ADD CONSTRAINT fk_department
    FOREIGN KEY (department_id)
    REFERENCES departments (id);

INSERT INTO departments (name, location) VALUES
('Sales', 'New York'),
('Marketing', 'London'),
('Engineering', 'San Francisco');

INSERT INTO employees (first_name, last_name, email, hire_date, job_id, salary, department_id) VALUES
('John', 'Doe', 'john.doe@example.com', '2023-01-15', 1, 60000.00, 1),
('Jane', 'Smith', 'jane.smith@example.com', '2022-05-20', 2, 75000.00, 2),
('Peter', 'Jones', 'peter.jones@example.com', '2023-03-10', 3, 90000.00, 3);

SELECT * FROM employees;

SELECT first_name, last_name FROM employees WHERE salary > 70000.00;

UPDATE employees SET salary = 65000.00 WHERE id = 1;

DELETE FROM employees WHERE id = 3;

CREATE INDEX idx_last_name ON employees (last_name);

SELECT e.first_name, d.name AS department_name
FROM employees e
JOIN departments d ON e.department_id = d.id;

-- Example using PostgreSQL specific feature: JSONB
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    details JSONB
);

INSERT INTO products (name, details) VALUES
('Laptop', '{"brand": "Dell", "model": "XPS 13", "price": 1200}');

SELECT name, details ->> 'brand' AS brand FROM products;

-- Example using PostgreSQL specific feature: UUID
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL
);

INSERT INTO users (username) VALUES ('testuser');

SELECT * FROM users;

-- Example using window functions
SELECT
    first_name,
    salary,
    RANK() OVER (ORDER BY salary DESC) as salary_rank
FROM
    employees;