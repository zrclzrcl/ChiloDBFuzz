CREATE UNLOGGED TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    signup_date TIMESTAMP WITHOUT TIME ZONE DEFAULT (NOW() AT TIME ZONE 'UTC'),
    last_login TIMESTAMPTZ,
    is_active BOOLEAN DEFAULT TRUE,
    preferences JSONB
);

CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) CHECK (price > 0),
    category VARCHAR(50),
    inventory_count INT DEFAULT 0
);

CREATE INDEX idx_products_name ON products (name);

INSERT INTO users (username, email, preferences) VALUES
('john_doe', 'john.doe@example.com', '{"theme": "dark", "notifications": true}'),
('jane_smith', 'jane.smith@example.com', '{"theme": "light", "notifications": false}');

INSERT INTO products (name, price, category, inventory_count) VALUES
('Awesome Widget', 19.99, 'Gadgets', 100),
('Deluxe Sprocket', 29.99, 'Parts', 50);

UPDATE users SET last_login = NOW() WHERE username = 'john_doe';

SELECT * FROM users WHERE username ILIKE '%doe%';

DELETE FROM products WHERE price > 50;

ALTER TABLE users ADD COLUMN full_name VARCHAR(150);

UPDATE users SET full_name = username WHERE full_name IS NULL;

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    order_date DATE DEFAULT CURRENT_DATE,
    total_amount DECIMAL(10, 2)
);

INSERT INTO orders (user_id, total_amount) VALUES (1, 49.98);

SELECT u.username, o.order_date, o.total_amount
FROM users u
JOIN orders o ON u.id = o.user_id
WHERE u.username = 'john_doe';

CREATE EXTENSION IF NOT EXISTS pgcrypto;

UPDATE users SET email = gen_random_uuid() || '@example.com' WHERE id = 2;

CREATE TABLE employees (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100),
  salary DECIMAL(10, 2),
  start_date DATE,
  end_date DATE,
  salary_range int4range GENERATED ALWAYS AS (int4range(salary, salary)) STORED
);

INSERT INTO employees (name, salary, start_date, end_date) VALUES ('Alice', 60000, '2023-01-01', '2024-01-01');

WITH UserOrderSummary AS (
    SELECT
        u.username,
        COUNT(o.order_id) AS total_orders,
        SUM(o.total_amount) AS total_spent
    FROM
        users u
    LEFT JOIN
        orders o ON u.id = o.user_id
    GROUP BY
        u.username
    ORDER BY
        total_spent DESC
    LIMIT 5
)
SELECT * FROM UserOrderSummary;

CREATE TABLE data_types_test (
  id SERIAL PRIMARY KEY,
  small_int SMALLINT,
  normal_int INTEGER,
  big_int BIGINT,
  floating_point REAL,
  double_precision DOUBLE PRECISION,
  str TEXT,
  bool BOOLEAN,
  uuid UUID,
  time_with_tz TIMETZ,
  time_without_tz TIME,
  date_only DATE
);

INSERT INTO data_types_test (small_int, normal_int, big_int, floating_point, double_precision, str, bool, uuid, time_with_tz, time_without_tz, date_only) VALUES
(10, 1000, 1000000, 3.14, 3.14159265359, 'Test String', TRUE, gen_random_uuid(), '10:30:00+02', '10:30:00', '2024-01-01');

SELECT id, floating_point, double_precision FROM data_types_test;

DROP TABLE IF EXISTS data_types_test;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS employees;
DROP TABLE IF EXISTS users;