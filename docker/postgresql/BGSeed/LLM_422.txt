CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    salary DECIMAL(10, 2),
    hire_date DATE,
    department VARCHAR(50)
);

INSERT INTO employees (name, salary, hire_date, department) VALUES
('Alice Smith', 60000.00, '2022-01-15', 'Sales'),
('Bob Johnson', 75000.00, '2021-05-20', 'Marketing'),
('Charlie Brown', 55000.00, '2023-03-10', 'Sales'),
('David Lee', 80000.00, '2020-11-01', 'Engineering'),
('Eve Wilson', 90000.00, '2019-08-25', 'Engineering');

CREATE INDEX idx_employees_department ON employees (department);

SELECT * FROM employees WHERE department = 'Sales';

UPDATE employees SET salary = salary * 1.10 WHERE department = 'Marketing';

DELETE FROM employees WHERE id = 3;

ALTER TABLE employees ADD COLUMN email VARCHAR(100);

UPDATE employees SET email = LOWER(REPLACE(name, ' ', '.')) || '@example.com';

SELECT AVG(salary) FROM employees;

SELECT department, SUM(salary) FROM employees GROUP BY department;

SELECT name FROM employees ORDER BY salary DESC LIMIT 2;

CREATE VIEW high_earners AS
SELECT name, salary FROM employees WHERE salary > 70000;

SELECT * FROM high_earners;

DROP VIEW high_earners;

CREATE TABLE departments (
    dept_id SERIAL PRIMARY KEY,
    dept_name VARCHAR(50) UNIQUE
);

INSERT INTO departments (dept_name) VALUES ('HR'), ('Finance'), ('IT');

ALTER TABLE employees ADD COLUMN dept_id INTEGER REFERENCES departments(dept_id);

UPDATE employees SET dept_id = 1 WHERE department = 'Sales';
UPDATE employees SET dept_id = 2 WHERE department = 'Marketing';
UPDATE employees SET dept_id = 3 WHERE department = 'Engineering';

SELECT e.name, d.dept_name FROM employees e JOIN departments d ON e.dept_id = d.dept_id;

CREATE OR REPLACE FUNCTION increment_salary(emp_id INTEGER, amount DECIMAL)
RETURNS VOID AS $$
BEGIN
    UPDATE employees SET salary = salary + amount WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

SELECT increment_salary(1, 5000);

SELECT * FROM employees WHERE id = 1;

DROP FUNCTION increment_salary(INTEGER, DECIMAL);

CREATE TABLE logs (
    log_id SERIAL PRIMARY KEY,
    log_time TIMESTAMP WITH TIME ZONE DEFAULT now(),
    message TEXT
);

INSERT INTO logs (message) VALUES ('Employee Alice Smith updated.');

SELECT * FROM logs;

CREATE MATERIALIZED VIEW mv_employee_salaries AS
SELECT department, AVG(salary) AS avg_salary
FROM employees
GROUP BY department;

REFRESH MATERIALIZED VIEW mv_employee_salaries;

SELECT * FROM mv_employee_salaries;

DROP MATERIALIZED VIEW mv_employee_salaries;

-- Use of GENERATE_SERIES
SELECT generate_series(1, 10);

-- Use of UNNEST
SELECT UNNEST(ARRAY[1,2,3,4,5]);

-- Example using window functions
SELECT
    name,
    salary,
    RANK() OVER (ORDER BY salary DESC) as salary_rank
FROM
    employees;

DROP TABLE employees;
DROP TABLE departments;
DROP TABLE logs;