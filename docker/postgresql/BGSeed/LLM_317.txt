CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    department VARCHAR(50),
    salary DECIMAL(10, 2),
    data JSONB
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    location VARCHAR(50)
);

INSERT INTO departments (name, location) VALUES
('Sales', 'New York'),
('Marketing', 'London'),
('Engineering', 'San Francisco');

INSERT INTO employees (name, department, salary, data) VALUES
('Alice Smith', 'Sales', 60000.00, '{"age": 30, "experience": 5}'),
('Bob Johnson', 'Marketing', 75000.00, '{"age": 35, "experience": 10}'),
('Charlie Brown', 'Engineering', 90000.00, '{"age": 40, "experience": 15}');

SELECT * FROM employees;

SELECT name, salary FROM employees WHERE department = 'Sales';

UPDATE employees SET salary = 65000.00 WHERE name = 'Alice Smith';

DELETE FROM employees WHERE id = 3;

SELECT AVG(salary) FROM employees;

CREATE INDEX CONCURRENTLY idx_employee_department ON employees (department);

SELECT e.name, d.location
FROM employees e
JOIN departments d ON e.department = d.name;

-- Demonstrate JSONB functionality
SELECT name, data ->> 'age' AS age FROM employees;

-- Demonstrate a window function
SELECT name, salary, RANK() OVER (ORDER BY salary DESC) AS salary_rank FROM employees;

-- Test SERIAL with a sequence query
SELECT nextval(pg_get_serial_sequence('employees', 'id'));