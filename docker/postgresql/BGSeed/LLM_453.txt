CREATE TABLE employee (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    salary DECIMAL(10, 2),
    hire_date DATE,
    department VARCHAR(50)
);

INSERT INTO employee (name, salary, hire_date, department) VALUES
('Alice Smith', 60000.00, '2022-01-15', 'Sales'),
('Bob Johnson', 75000.00, '2021-05-20', 'Marketing'),
('Charlie Brown', 55000.00, '2023-03-10', 'Sales'),
('David Lee', 80000.00, '2020-11-01', 'Engineering');

CREATE INDEX idx_employee_department ON employee (department);

SELECT department, AVG(salary) AS avg_salary FROM employee GROUP BY department HAVING AVG(salary) > 65000;

UPDATE employee SET salary = salary * 1.1 WHERE department = 'Sales';

DELETE FROM employee WHERE hire_date < '2021-01-01';

SELECT name, salary FROM employee WHERE salary BETWEEN 60000 AND 80000 ORDER BY salary DESC LIMIT 5;

CREATE VIEW high_earners AS
SELECT id, name, salary FROM employee WHERE salary > 70000;

SELECT * FROM high_earners;

DROP VIEW high_earners;

ALTER TABLE employee ADD COLUMN bonus DECIMAL(10, 2);

UPDATE employee SET bonus = salary * 0.05 WHERE department = 'Engineering';

SELECT name, salary, bonus, salary + bonus AS total_compensation FROM employee;

CREATE FUNCTION calculate_bonus(emp_id INTEGER) RETURNS DECIMAL(10, 2) AS $$
BEGIN
    RETURN (SELECT salary * 0.1 FROM employee WHERE id = emp_id);
END;
$$ LANGUAGE plpgsql;

SELECT id, name, calculate_bonus(id) AS calculated_bonus FROM employee;

DROP FUNCTION calculate_bonus(INTEGER);

SELECT COUNT(*) OVER () AS total_employees, * FROM employee;

SELECT name,
       RANK() OVER (ORDER BY salary DESC) as salary_rank
FROM employee;

WITH RankedSalaries AS (
    SELECT
        name,
        salary,
        RANK() OVER (ORDER BY salary DESC) as salary_rank
    FROM employee
)
SELECT name, salary FROM RankedSalaries WHERE salary_rank <= 3;

SELECT current_database();

SELECT version();

SHOW search_path;

SET search_path TO public, pg_catalog;

SELECT * FROM pg_timezone_names WHERE name LIKE '%America%';

SELECT inet_client_addr();

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    price NUMERIC(10, 2) CHECK (price > 0),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

INSERT INTO products (name, description, price) VALUES
('Laptop', 'High-performance laptop', 1200.00),
('Mouse', 'Wireless mouse', 25.00),
('Keyboard', 'Mechanical keyboard', 100.00);

SELECT * FROM products WHERE created_at > now() - interval '1 week';

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    order_date DATE DEFAULT CURRENT_DATE,
    total_amount NUMERIC(10, 2)
);

INSERT INTO orders (customer_id, total_amount) VALUES
(1, 1225.00),
(2, 25.00),
(1, 100.00);

SELECT e.name AS employee_name, o.total_amount AS order_amount
FROM employee e
INNER JOIN orders o ON e.id = o.customer_id;

CREATE MATERIALIZED VIEW product_summary AS
SELECT department, COUNT(*) AS product_count, AVG(salary) AS avg_salary FROM employee GROUP BY department;

SELECT * FROM product_summary;

REFRESH MATERIALIZED VIEW product_summary;

DROP MATERIALIZED VIEW product_summary;

CREATE SEQUENCE my_sequence START 100 INCREMENT BY 5;

SELECT nextval('my_sequence');

SELECT currval('my_sequence');

SELECT setval('my_sequence', 200);

DROP SEQUENCE my_sequence;

CREATE TYPE address AS (
    street VARCHAR(100),
    city VARCHAR(50),
    zip_code VARCHAR(10)
);

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    home_address address
);

INSERT INTO users (name, home_address) VALUES
('John Doe', ('123 Main St', 'Anytown', '12345'));

SELECT (home_address).street, (home_address).city FROM users;

DROP TABLE users;
DROP TYPE address;

CREATE DOMAIN email AS VARCHAR(255)
CHECK (VALUE LIKE '%@%.%');

CREATE TABLE contacts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    email email
);

INSERT INTO contacts (name, email) VALUES
('Jane Smith', 'jane.smith@example.com');

DROP TABLE contacts;
DROP DOMAIN email;

CREATE TABLE audit_log (
    id SERIAL PRIMARY KEY,
    event_time TIMESTAMP WITHOUT TIME ZONE DEFAULT now(),
    description TEXT
);

CREATE OR REPLACE FUNCTION log_event(event_description TEXT) RETURNS VOID AS $$
BEGIN
    INSERT INTO audit_log (description) VALUES (event_description);
END;
$$ LANGUAGE plpgsql;

SELECT log_event('Employee table updated');

SELECT * FROM audit_log;

DROP FUNCTION log_event(TEXT);
DROP TABLE audit_log;

CREATE TEXT SEARCH CONFIGURATION my_config (COPY = english);
ALTER TEXT SEARCH CONFIGURATION my_config ALTER MAPPING FOR hword, hword_part, word WITH simple;
SELECT * FROM ts_parse('default', 'A fat  rats');
DROP TEXT SEARCH CONFIGURATION my_config;

CREATE OR REPLACE FUNCTION jsonb_pretty_custom(data jsonb)
RETURNS TEXT
AS $$
  BEGIN
    RETURN jsonb_pretty(data);
  END;
$$ LANGUAGE plpgsql;
SELECT jsonb_pretty_custom('{"a":1, "b":2}'::jsonb);
DROP FUNCTION jsonb_pretty_custom(data jsonb);

CREATE COLLATION german (locale = 'de_DE.utf8');
CREATE TABLE test1 (
    id serial primary key,
    name varchar(100) COLLATE german
);
INSERT INTO test1(name) VALUES ('Aaa');
INSERT INTO test1(name) VALUES ('aaa');
SELECT name FROM test1 ORDER BY name;
DROP TABLE test1;
DROP COLLATION german;