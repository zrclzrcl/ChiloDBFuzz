CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(50) NOT NULL,
    price DECIMAL(10, 2)
);

INSERT INTO products (product_name, price) VALUES
('Laptop', 1200.00),
('Mouse', 25.00),
('Keyboard', 75.00),
('Monitor', 300.00);

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    order_date DATE,
    total_amount DECIMAL(10, 2)
);

CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(50) NOT NULL,
    city VARCHAR(50)
);

INSERT INTO customers (customer_name, city) VALUES
('John Doe', 'New York'),
('Jane Smith', 'Los Angeles'),
('Peter Jones', 'Chicago');

INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, '2024-01-15', 1225.00),
(2, '2024-01-20', 75.00),
(1, '2024-02-01', 300.00);

SELECT * FROM products WHERE price > 100;

SELECT customer_name, city FROM customers WHERE city = 'New York';

SELECT order_id, order_date FROM orders WHERE customer_id = 1;

UPDATE products SET price = 1300.00 WHERE product_name = 'Laptop';

DELETE FROM products WHERE product_name = 'Mouse';

SELECT AVG(price) FROM products;

SELECT COUNT(*) FROM orders;

SELECT MAX(total_amount) FROM orders;

SELECT MIN(total_amount) FROM orders;

SELECT SUM(total_amount) FROM orders;

SELECT c.customer_name, o.order_date, o.total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id;

SELECT p.product_name, p.price
FROM products p
WHERE p.price > (SELECT AVG(price) FROM products);

CREATE INDEX idx_customer_city ON customers (city);

EXPLAIN SELECT * FROM customers WHERE city = 'New York';

ALTER TABLE products ADD COLUMN description TEXT;

UPDATE products SET description = 'High-performance laptop' WHERE product_name = 'Laptop';

SELECT * FROM products WHERE description LIKE '%performance%';

-- Using PostgreSQL specific feature: ILIKE (case-insensitive like)
SELECT * FROM products WHERE product_name ILIKE 'lap%';

-- Using PostgreSQL specific feature: JSONB operators
CREATE TABLE product_details (
    product_id INTEGER PRIMARY KEY,
    details JSONB
);

INSERT INTO product_details (product_id, details) VALUES (1, '{"screen_size": "15 inch", "memory": "16GB"}');

SELECT details ->> 'screen_size' FROM product_details WHERE product_id = 1;

-- Using PostgreSQL specific feature: array
CREATE TABLE product_tags (
    product_id INTEGER PRIMARY KEY,
    tags TEXT[]
);

INSERT INTO product_tags (product_id, tags) VALUES (1, '{"laptop", "electronic", "computer"}');

SELECT tags[1] FROM product_tags WHERE product_id = 1;

-- Using PostgreSQL specific feature: UUID
CREATE TABLE users (
    user_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) NOT NULL
);

INSERT INTO users (username) VALUES ('test_user');

SELECT user_id FROM users WHERE username = 'test_user';

-- Window functions
SELECT
    product_name,
    price,
    RANK() OVER (ORDER BY price DESC) as price_rank
FROM
    products;

-- Common Table Expressions (CTEs)
WITH ExpensiveProducts AS (
    SELECT product_name, price
    FROM products
    WHERE price > 500
)
SELECT * FROM ExpensiveProducts;

-- Full Text Search
ALTER TABLE products ADD COLUMN searchable_text tsvector;

UPDATE products SET searchable_text = to_tsvector('english', product_name || ' ' || coalesce(description, ''));

CREATE INDEX idx_products_searchable_text ON products USING GIN (searchable_text);

SELECT * FROM products WHERE searchable_text @@ to_tsquery('english', 'laptop');

-- Partitioning
CREATE TABLE sales (
    sale_id SERIAL PRIMARY KEY,
    sale_date DATE NOT NULL,
    region VARCHAR(50) NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);

CREATE TABLE sales_y2023 PARTITION OF sales FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');

INSERT INTO sales (sale_date, region, amount) VALUES ('2023-05-10', 'North', 1000.00);