CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary DECIMAL(10, 2),
    department VARCHAR(50)
);

CREATE INDEX idx_employees_department ON employees (department);

INSERT INTO employees (name, salary, department) VALUES
('Alice Smith', 60000.00, 'Sales'),
('Bob Johnson', 75000.00, 'Marketing'),
('Charlie Brown', 50000.00, 'Sales'),
('David Lee', 80000.00, 'Engineering'),
('Eve Wilson', 65000.00, 'Marketing');

CREATE VIEW high_earners AS
SELECT name, salary
FROM employees
WHERE salary > 65000.00;

SELECT * FROM high_earners;

UPDATE employees SET salary = salary * 1.1 WHERE department = 'Sales';

DELETE FROM employees WHERE id = 3;

SELECT AVG(salary) FROM employees;

SELECT department, SUM(salary) AS total_salary FROM employees GROUP BY department;

SELECT * FROM employees WHERE name LIKE 'A%';

SELECT name, salary FROM employees ORDER BY salary DESC LIMIT 2;

SELECT e1.name, e1.salary, e2.department
FROM employees e1
JOIN employees e2 ON e1.department = e2.department
WHERE e1.id != e2.id;

CREATE OR REPLACE FUNCTION increment_salary(emp_id INT, increment DECIMAL)
RETURNS VOID AS $$
BEGIN
    UPDATE employees SET salary = salary + increment WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

SELECT increment_salary(1, 5000.00);

SELECT * FROM employees WHERE id = 1;

CREATE TABLE audit_log (
    id SERIAL PRIMARY KEY,
    table_name VARCHAR(255),
    operation VARCHAR(50),
    timestamp TIMESTAMP DEFAULT NOW()
);

CREATE OR REPLACE FUNCTION log_employee_changes()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation)
    VALUES ('employees', TG_OP);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER employee_audit
AFTER INSERT OR UPDATE OR DELETE ON employees
FOR EACH ROW
EXECUTE FUNCTION log_employee_changes();

INSERT INTO employees (name, salary, department) VALUES ('Grace Davis', 70000.00, 'Engineering');
UPDATE employees SET salary = 85000.00 WHERE id = 4;
DELETE FROM employees WHERE id = 5;

SELECT * FROM audit_log;

PREPARE employee_query (VARCHAR) AS
SELECT * FROM employees WHERE department = $1;

EXECUTE employee_query('Marketing');

DEALLOCATE employee_query;

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2)
);

INSERT INTO products (name, price) VALUES ('Laptop', 1200.00), ('Mouse', 25.00);

CREATE MATERIALIZED VIEW expensive_products AS
SELECT * FROM products WHERE price > 1000;

SELECT * FROM expensive_products;

REFRESH MATERIALIZED VIEW expensive_products;

ALTER TABLE employees ADD COLUMN email VARCHAR(100) UNIQUE;

INSERT INTO employees (name, salary, department, email) VALUES ('Harry White', 55000.00, 'HR', 'harry.white@example.com');

CREATE DOMAIN us_postal_code AS TEXT
CHECK (VALUE ~ '^\d{5}(-\d{4})?$');

CREATE TABLE addresses (
    id SERIAL PRIMARY KEY,
    street VARCHAR(255),
    zip_code us_postal_code
);

INSERT INTO addresses (street, zip_code) VALUES ('123 Main St', '12345');
INSERT INTO addresses (street, zip_code) VALUES ('456 Oak Ave', '67890-1234');

CREATE SEQUENCE serial_number_seq START 1001;

SELECT nextval('serial_number_seq');

ALTER TABLE employees ADD COLUMN hire_date DATE;
UPDATE employees SET hire_date = CURRENT_DATE - INTERVAL '3 months' WHERE id = 1;

SELECT date_trunc('month', hire_date) FROM employees;