CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO products (name, description, price) VALUES
    ('Laptop', 'High-performance laptop for professional use', 1200.50),
    ('Mouse', 'Ergonomic wireless mouse', 25.99),
    ('Keyboard', 'Mechanical keyboard with RGB lighting', 100.00),
    ('Monitor', '27-inch 4K UHD monitor', 350.75),
    ('Headphones', 'Noise-cancelling headphones with microphone', 150.25);

CREATE INDEX idx_products_name ON products (name);

SELECT id, name, price FROM products WHERE price > 50 ORDER BY price DESC LIMIT 3;

UPDATE products SET price = price * 1.1 WHERE id IN (1, 3, 5);

DELETE FROM products WHERE id = 2;

SELECT COUNT(*) FROM products;

SELECT AVG(price) FROM products;

SELECT MAX(price), MIN(price) FROM products;

SELECT name, LENGTH(name) FROM products;

SELECT UPPER(name), LOWER(name) FROM products;

SELECT SUBSTRING(description, 1, 20) FROM products;

SELECT * FROM products WHERE name LIKE '%Laptop%';

SELECT * FROM products WHERE description ILIKE '%noise%';

SELECT created_at AT TIME ZONE 'UTC', created_at AT TIME ZONE 'America/Los_Angeles' FROM products;

SELECT EXTRACT(YEAR FROM created_at), EXTRACT(MONTH FROM created_at), EXTRACT(DAY FROM created_at) FROM products;

SELECT to_char(created_at, 'YYYY-MM-DD HH24:MI:SS') FROM products;

CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

INSERT INTO categories (name) VALUES
    ('Electronics'),
    ('Accessories');

ALTER TABLE products ADD COLUMN category_id INTEGER REFERENCES categories(id);

UPDATE products SET category_id = 1 WHERE id IN (1, 3, 4, 5);
UPDATE products SET category_id = 2 WHERE id IN (2);

SELECT products.name, categories.name FROM products JOIN categories ON products.category_id = categories.id;

CREATE VIEW product_category AS
SELECT products.name AS product_name, categories.name AS category_name
FROM products JOIN categories ON products.category_id = categories.id;

SELECT * FROM product_category WHERE category_name = 'Electronics';

CREATE FUNCTION discount_price(price DECIMAL, discount DECIMAL)
RETURNS DECIMAL AS $$
BEGIN
    RETURN price * (1 - discount);
END;
$$ LANGUAGE plpgsql;

SELECT name, price, discount_price(price, 0.1) AS discounted_price FROM products;

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    order_date DATE NOT NULL DEFAULT CURRENT_DATE
);

INSERT INTO orders (product_id, quantity) VALUES
    (1, 2),
    (3, 1),
    (4, 3);

SELECT products.name, SUM(orders.quantity)
FROM orders JOIN products ON orders.product_id = products.id
GROUP BY products.name;

-- Example of using window functions
SELECT
    name,
    price,
    RANK() OVER (ORDER BY price DESC) as price_rank
FROM
    products;

-- Example using common table expression (CTE)
WITH RankedProducts AS (
    SELECT
        name,
        price,
        RANK() OVER (ORDER BY price DESC) as price_rank
    FROM
        products
)
SELECT name, price FROM RankedProducts WHERE price_rank <= 2;

-- Example using generate_series
SELECT generate_series(1, 10);

-- Example using pg_sleep
SELECT pg_sleep(0.1);