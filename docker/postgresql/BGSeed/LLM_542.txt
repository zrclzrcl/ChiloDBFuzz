CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    salary DECIMAL(10, 2),
    hire_date DATE
);

INSERT INTO employees (name, salary, hire_date) VALUES
('Alice', 60000.00, '2023-01-15'),
('Bob', 75000.00, '2022-05-20'),
('Charlie', 80000.00, '2023-03-10');

CREATE INDEX idx_salary ON employees (salary);

SELECT * FROM employees WHERE salary > 70000.00;

UPDATE employees SET salary = 85000.00 WHERE name = 'Bob';

DELETE FROM employees WHERE name = 'Charlie';

SELECT AVG(salary) FROM employees;

SELECT MIN(salary), MAX(salary) FROM employees;

SELECT COUNT(*) FROM employees;

SELECT name, EXTRACT(YEAR FROM hire_date) AS hire_year FROM employees;

SELECT name, AGE(hire_date) FROM employees;

SELECT to_char(hire_date, 'YYYY-MM-DD') FROM employees;

CREATE VIEW high_earners AS
SELECT name, salary FROM employees WHERE salary > 70000.00;

SELECT * FROM high_earners;

DROP VIEW high_earners;

ALTER TABLE employees ADD COLUMN department VARCHAR(50);

UPDATE employees SET department = 'Sales' WHERE name = 'Alice';
UPDATE employees SET department = 'Marketing' WHERE name = 'Bob';

SELECT department, AVG(salary) FROM employees GROUP BY department;

CREATE FUNCTION increment_salary(emp_id INTEGER, amount DECIMAL)
RETURNS VOID AS $$
BEGIN
    UPDATE employees SET salary = salary + amount WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

SELECT increment_salary(1, 5000.00);

SELECT * FROM employees WHERE id = 1;

DROP FUNCTION increment_salary(INTEGER, DECIMAL);

CREATE TEXT SEARCH DICTIONARY english_stem_nostop (
    Template = snowball,
    Language = english
);

SELECT ts_lexize('english_stem_nostop', 'running');

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2)
);

INSERT INTO products (name, description, price) VALUES
('Laptop', 'High-performance laptop', 1200.00),
('Mouse', 'Wireless mouse', 25.00),
('Keyboard', 'Mechanical keyboard', 75.00);

CREATE INDEX idx_product_name ON products (name);

SELECT * FROM products WHERE name LIKE 'L%';

SELECT description FROM products WHERE to_tsvector('english', description) @@ to_tsquery('english', 'high & performance');

SELECT name, price FROM products ORDER BY price DESC;

SELECT name, price FROM products LIMIT 2;

SELECT name, price FROM products OFFSET 1 LIMIT 1;

CREATE MATERIALIZED VIEW product_summary AS
SELECT COUNT(*) AS total_products, AVG(price) AS average_price FROM products;

REFRESH MATERIALIZED VIEW product_summary;

SELECT * FROM product_summary;

DROP MATERIALIZED VIEW product_summary;

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    order_date DATE,
    total_amount DECIMAL(10, 2)
);

INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, '2024-01-05', 250.00),
(2, '2024-01-10', 100.00),
(1, '2024-01-15', 500.00);

SELECT customer_id, SUM(total_amount) FROM orders GROUP BY customer_id;

SELECT e.name, o.total_amount
FROM employees e
JOIN orders o ON e.id = o.customer_id;

WITH customer_orders AS (
    SELECT customer_id, SUM(total_amount) AS total_spent
    FROM orders
    GROUP BY customer_id
)
SELECT e.name, co.total_spent
FROM employees e
JOIN customer_orders co ON e.id = co.customer_id;

CREATE TYPE employee_type AS (
    id INTEGER,
    name VARCHAR(50),
    salary DECIMAL(10, 2)
);

CREATE FUNCTION get_employee(emp_id INTEGER)
RETURNS employee_type AS $$
SELECT id, name, salary FROM employees WHERE id = emp_id;
$$ LANGUAGE SQL;

SELECT get_employee(1);

DROP FUNCTION get_employee(INTEGER);
DROP TYPE employee_type;