CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    salary DECIMAL(10, 2),
    start_date DATE
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE
);

ALTER TABLE employees ADD COLUMN department_id INTEGER REFERENCES departments(id);

INSERT INTO departments (name) VALUES ('Sales'), ('Marketing'), ('Engineering');

INSERT INTO employees (name, salary, start_date, department_id) VALUES
('Alice', 60000, '2023-01-15', 1),
('Bob', 75000, '2022-07-01', 2),
('Charlie', 90000, '2023-03-10', 3);

CREATE INDEX idx_employee_name ON employees (name);

CREATE VIEW employee_salaries AS
SELECT e.name, e.salary, d.name AS department
FROM employees e
JOIN departments d ON e.department_id = d.id;

SELECT * FROM employee_salaries WHERE salary > 70000;

UPDATE employees SET salary = salary * 1.1 WHERE department_id = 3;

DELETE FROM employees WHERE start_date < '2022-08-01';

CREATE FUNCTION increment_salary(emp_id INTEGER, amount DECIMAL) RETURNS VOID AS $$
BEGIN
    UPDATE employees SET salary = salary + amount WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

SELECT increment_salary(1, 5000);

CREATE TABLE audit_log (
    id SERIAL PRIMARY KEY,
    table_name VARCHAR(100),
    record_id INTEGER,
    change_date TIMESTAMP DEFAULT NOW()
);

CREATE OR REPLACE FUNCTION log_employee_changes()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, record_id)
    VALUES ('employees', OLD.id);
    RETURN OLD;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER employee_delete_trigger
BEFORE DELETE ON employees
FOR EACH ROW
EXECUTE FUNCTION log_employee_changes();

DELETE FROM employees WHERE id = 2;

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0)
);