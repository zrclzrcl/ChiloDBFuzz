SET extra_float_digits = 0;

CREATE TABLE employee (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    salary DECIMAL(10, 2),
    department VARCHAR(50),
    hire_date DATE
);

INSERT INTO employee (name, salary, department, hire_date) VALUES
('Alice Smith', 60000.00, 'Sales', '2022-01-15'),
('Bob Johnson', 75000.00, 'Marketing', '2021-05-20'),
('Charlie Brown', 50000.00, 'Sales', '2023-03-10'),
('Diana Miller', 90000.00, 'Engineering', '2020-11-01'),
('Eve Davis', 80000.00, 'Marketing', '2022-09-05');

CREATE INDEX idx_employee_department ON employee (department);

CREATE VIEW sales_employees AS
SELECT id, name, salary, hire_date
FROM employee
WHERE department = 'Sales';

CREATE VIEW marketing_employees AS
SELECT id, name, salary, hire_date
FROM employee
WHERE department = 'Marketing';

CREATE MATERIALIZED VIEW high_earners AS
SELECT id, name, salary, department
FROM employee
WHERE salary > 70000.00;

REFRESH MATERIALIZED VIEW high_earners;

CREATE FUNCTION increment_salary(emp_id INTEGER, amount DECIMAL)
RETURNS VOID AS $$
BEGIN
    UPDATE employee SET salary = salary + amount WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

SELECT increment_salary(1, 5000.00);

CREATE DOMAIN email AS TEXT
CHECK (VALUE LIKE '%@%.%');

ALTER TABLE employee ADD COLUMN email email;

UPDATE employee SET email = 'alice.smith@example.com' WHERE id = 1;

CREATE SEQUENCE seq_employee_id START 100;

ALTER TABLE employee ALTER COLUMN id SET DEFAULT nextval('seq_employee_id');

INSERT INTO employee (name, salary, department, hire_date) VALUES ('New Employee', 55000.00, 'HR', '2024-01-01');

SELECT * FROM employee WHERE salary BETWEEN 50000 AND 80000;

SELECT department, AVG(salary) AS avg_salary FROM employee GROUP BY department;

SELECT COUNT(*) FROM employee;

SELECT MAX(salary) FROM employee;

SELECT name FROM employee ORDER BY salary DESC LIMIT 3;

SELECT * FROM sales_employees;

SELECT * FROM marketing_employees;

SELECT * FROM high_earners;

EXPLAIN ANALYZE SELECT * FROM employee WHERE department = 'Engineering';

CREATE TABLE audit_log (
    log_id SERIAL PRIMARY KEY,
    table_name VARCHAR(100),
    operation VARCHAR(50),
    timestamp TIMESTAMP DEFAULT NOW()
);

CREATE OR REPLACE FUNCTION log_employee_changes()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation)
    VALUES ('employee', TG_OP);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER employee_audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON employee
FOR EACH ROW
EXECUTE FUNCTION log_employee_changes();

UPDATE employee SET salary = 65000.00 WHERE id = 1;

DELETE FROM employee WHERE id = 5;

SELECT * FROM audit_log;

DROP FUNCTION increment_salary(INTEGER, DECIMAL);

DROP TRIGGER employee_audit_trigger ON employee;

DROP FUNCTION log_employee_changes();

DROP TABLE audit_log;

DROP MATERIALIZED VIEW high_earners;

DROP VIEW sales_employees;

DROP VIEW marketing_employees;

DROP INDEX idx_employee_department;

DROP TABLE employee;

DROP SEQUENCE seq_employee_id;