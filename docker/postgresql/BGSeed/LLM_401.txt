CREATE UNLOGGED TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    department VARCHAR(50),
    salary INTEGER,
    data JSONB
);

INSERT INTO employees (name, department, salary, data) VALUES
('Alice', 'Sales', 60000, '{"bonus": true, "years": 5}'),
('Bob', 'Marketing', 70000, '{"bonus": false, "years": 2}'),
('Charlie', 'Engineering', 80000, '{"bonus": true, "years": 10}'),
('David', 'Sales', 65000, '{"bonus": true, "years": 7}'),
('Eve', 'Marketing', 75000, '{"bonus": false, "years": 3}');

CREATE TABLE departments (
    dept_id SERIAL PRIMARY KEY,
    dept_name VARCHAR(50),
    location VARCHAR(50)
);

INSERT INTO departments (dept_name, location) VALUES
('Sales', 'New York'),
('Marketing', 'London'),
('Engineering', 'San Francisco');

SELECT e.name, d.dept_name, d.location
FROM employees e
JOIN departments d ON e.department = d.dept_name
WHERE e.salary > 65000;

UPDATE employees SET salary = salary * 1.1 WHERE department = 'Sales';

DELETE FROM employees WHERE salary < 60000;

SELECT department, AVG(salary) AS average_salary
FROM employees
GROUP BY department
ORDER BY average_salary DESC;

SELECT name, salary FROM employees ORDER BY salary DESC LIMIT 3;

SELECT
    name,
    CASE
        WHEN salary > 70000 THEN 'High'
        WHEN salary > 60000 THEN 'Medium'
        ELSE 'Low'
    END AS salary_level
FROM employees;

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    order_date DATE,
    amount DECIMAL(10, 2)
);

INSERT INTO orders (customer_id, order_date, amount) VALUES
(1, '2024-01-01', 100.00),
(2, '2024-01-05', 200.00),
(1, '2024-01-10', 150.00),
(3, '2024-01-15', 300.00);

WITH high_spending_customers AS (
    SELECT customer_id
    FROM orders
    GROUP BY customer_id
    HAVING SUM(amount) > 250
)
SELECT e.name, d.dept_name
FROM employees e
JOIN departments d ON e.department = d.dept_name
WHERE e.id IN (SELECT customer_id FROM high_spending_customers);

CREATE INDEX CONCURRENTLY idx_employee_department ON employees (department);

CREATE TABLE products (
  product_id SERIAL PRIMARY KEY,
  product_name VARCHAR(255),
  price DECIMAL(10,2)
);

INSERT INTO products (product_name, price) VALUES
('Laptop', 1200.00),
('Mouse', 25.00),
('Keyboard', 75.00);

SELECT e.name, e.data ->> 'years' AS years_of_service FROM employees e;

CREATE TABLE array_test (
    id SERIAL PRIMARY KEY,
    int_array INTEGER[],
    text_array TEXT[]
);

INSERT INTO array_test (int_array, text_array) VALUES
(ARRAY[1, 2, 3], ARRAY['a', 'b', 'c']),
(ARRAY[4, 5, 6], ARRAY['d', 'e', 'f']);

SELECT int_array[2] FROM array_test WHERE id = 1;

SELECT generate_series(1, 5);

SELECT jsonb_pretty(data) FROM employees;

CREATE TABLE test_range (
  id SERIAL PRIMARY KEY,
  tsrange TSRANGE
);

INSERT INTO test_range (tsrange) VALUES (TSRANGE('2024-01-01 00:00:00', '2024-01-02 00:00:00'));

SELECT * FROM test_range WHERE tsrange @> '2024-01-01 12:00:00'::TIMESTAMP;