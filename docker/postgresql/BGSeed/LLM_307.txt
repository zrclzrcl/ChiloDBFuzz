CREATE EXTENSION IF NOT EXISTS citext;

CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email CITEXT UNIQUE,
    salary DECIMAL(10, 2),
    hire_date DATE,
    department VARCHAR(50),
    is_active BOOLEAN DEFAULT TRUE,
    notes TEXT
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    location VARCHAR(100)
);

ALTER TABLE employees ADD CONSTRAINT fk_department FOREIGN KEY (department) REFERENCES departments(name);

INSERT INTO departments (name, location) VALUES
('Sales', 'New York'),
('Marketing', 'London'),
('Engineering', 'San Francisco');

INSERT INTO employees (name, email, salary, hire_date, department) VALUES
('Alice Smith', 'alice.smith@example.com', 60000.00, '2023-01-15', 'Sales'),
('Bob Johnson', 'bob.johnson@example.com', 75000.00, '2022-05-20', 'Marketing'),
('Charlie Brown', 'charlie.brown@example.com', 90000.00, '2021-11-01', 'Engineering');

UPDATE employees SET salary = 65000.00 WHERE name = 'Alice Smith';

DELETE FROM employees WHERE name = 'Charlie Brown';

SELECT * FROM employees;

SELECT name, salary FROM employees WHERE salary > 70000.00;

SELECT d.name AS department_name, COUNT(e.id) AS employee_count
FROM departments d
LEFT JOIN employees e ON d.name = e.department
GROUP BY d.name
ORDER BY employee_count DESC;

CREATE TYPE mood AS ENUM ('sad', 'ok', 'happy');

CREATE TABLE person (
    name text,
    current_mood mood
);

INSERT INTO person VALUES ('Moe', 'happy');
INSERT INTO person VALUES ('Larry', 'sad');
INSERT INTO person VALUES ('Curly', 'ok');

SELECT * FROM person WHERE current_mood = 'happy';

-- Use of ARRAY type
CREATE TABLE items (
    id SERIAL PRIMARY KEY,
    tags TEXT[]
);

INSERT INTO items (tags) VALUES (ARRAY['food', 'organic', 'vegetable']);
INSERT INTO items (tags) VALUES (ARRAY['electronics', 'portable', 'audio']);

SELECT * FROM items WHERE 'food' = ANY(tags);

-- JSONB example
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    details JSONB
);

INSERT INTO products (details) VALUES ('{"name": "Laptop", "price": 1200.00, "features": ["16GB RAM", "512GB SSD"]}');

SELECT details ->> 'name' AS product_name FROM products;

-- Example with WITH RECURSIVE (simple)
WITH RECURSIVE numbers AS (
    SELECT 1 AS n
    UNION ALL
    SELECT n + 1 FROM numbers WHERE n < 5
)
SELECT n FROM numbers;

CREATE TABLE parent_child (
  parent_id INTEGER,
  child_id INTEGER
);

INSERT INTO parent_child (parent_id, child_id) VALUES (1, 2), (1,3), (2,4), (2,5);

WITH RECURSIVE subordinates AS (
  SELECT parent_id, child_id
  FROM parent_child
  WHERE parent_id = 1
  UNION ALL
  SELECT pc.parent_id, pc.child_id
  FROM parent_child pc
  JOIN subordinates s ON pc.parent_id = s.child_id
)
SELECT * FROM subordinates;