CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    age INTEGER,
    salary DECIMAL(10, 2),
    hire_date DATE,
    department VARCHAR(50)
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    location VARCHAR(100)
);

INSERT INTO departments (name, location) VALUES
('Sales', 'New York'),
('Marketing', 'Los Angeles'),
('Engineering', 'San Francisco');

INSERT INTO employees (name, age, salary, hire_date, department) VALUES
('Alice Smith', 30, 60000.00, '2022-01-15', 'Sales'),
('Bob Johnson', 25, 50000.00, '2023-05-20', 'Marketing'),
('Charlie Brown', 35, 70000.00, '2021-11-01', 'Engineering'),
('David Lee', 28, 55000.00, '2024-02-10', 'Sales'),
('Eve Wilson', 40, 80000.00, '2020-07-04', 'Engineering');

SELECT * FROM employees WHERE age > 30 AND salary > 65000;
SELECT name, salary FROM employees ORDER BY salary DESC LIMIT 3;
SELECT COUNT(*) AS total_employees FROM employees;
SELECT AVG(salary) AS average_salary FROM employees WHERE department = 'Engineering';
SELECT department, SUM(salary) AS total_salary FROM employees GROUP BY department;
UPDATE employees SET salary = salary * 1.1 WHERE department = 'Marketing';
DELETE FROM employees WHERE hire_date < '2021-01-01';

CREATE INDEX idx_employee_department ON employees (department);

CREATE VIEW high_earners AS
SELECT name, salary, department
FROM employees
WHERE salary > 60000;

SELECT * FROM high_earners;

CREATE OR REPLACE FUNCTION calculate_bonus(emp_id INTEGER, bonus_percentage DECIMAL)
RETURNS DECIMAL AS $$
DECLARE
    base_salary DECIMAL;
    bonus_amount DECIMAL;
BEGIN
    SELECT salary INTO base_salary FROM employees WHERE id = emp_id;
    bonus_amount := base_salary * bonus_percentage;
    RETURN bonus_amount;
END;
$$ LANGUAGE plpgsql;

SELECT calculate_bonus(1, 0.10);
SELECT calculate_bonus(2, 0.05);

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) CHECK (price > 0),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO products (name, description, price) VALUES
('Laptop', 'High-performance laptop', 1200.00),
('Mouse', 'Wireless mouse', 25.00),
('Keyboard', 'Ergonomic keyboard', 75.00);

SELECT * FROM products WHERE price BETWEEN 50 AND 1500;
SELECT name, LENGTH(description) AS description_length FROM products;

-- PostgreSQL specific features

SELECT version();

-- Example using JSONB
CREATE TABLE json_example (
    id SERIAL PRIMARY KEY,
    data JSONB
);

INSERT INTO json_example (data) VALUES
('{"name": "John Doe", "age": 30, "address": {"street": "123 Main St", "city": "Anytown"}}'),
('{"name": "Jane Smith", "age": 25, "address": {"street": "456 Oak Ave", "city": "Springfield"}}');

SELECT data -> 'name' AS name FROM json_example;
SELECT data -> 'address' ->> 'city' AS city FROM json_example;

-- Example using arrays
CREATE TABLE array_example (
    id SERIAL PRIMARY KEY,
    tags TEXT[]
);

INSERT INTO array_example (tags) VALUES
(ARRAY['programming', 'python', 'development']),
(ARRAY['database', 'postgresql', 'sql']);

SELECT tags[1] AS first_tag FROM array_example;
SELECT * FROM array_example WHERE 'postgresql' = ANY(tags);

CREATE EXTENSION IF NOT EXISTS pg_trgm;
CREATE INDEX trgm_idx_products_name ON products USING gin (name gin_trgm_ops);
SELECT * FROM products WHERE name % 'Lap';

-- Example using window functions
SELECT
    name,
    salary,
    RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM employees;

-- Example using Common Table Expressions (CTEs)
WITH high_earners_cte AS (
    SELECT name, salary
    FROM employees
    WHERE salary > 60000
)
SELECT name, salary FROM high_earners_cte ORDER BY salary DESC;

-- Example of using generate_series
SELECT generate_series(1, 5);

-- Example using UUID
CREATE TABLE uuid_example (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100)
);

INSERT INTO uuid_example (name) VALUES ('Test UUID');
SELECT * FROM uuid_example;

-- Example using range types
CREATE TABLE reservation (
    room int,
    during tsrange
);
INSERT INTO reservation VALUES
    (1108, '[2010-12-11 11:00, 2010-12-11 13:00]');
SELECT * FROM reservation WHERE during @> '2010-12-11 11:30'::timestamp;