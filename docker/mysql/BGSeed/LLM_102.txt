CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    category VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO products (name, description, price, category) VALUES
('Awesome T-Shirt', 'A comfortable and stylish t-shirt.', 19.99, 'Clothing'),
('Amazing Mug', 'A ceramic mug for your favorite beverage.', 9.99, 'Home Goods'),
('Fantastic Book', 'A captivating novel.', 14.99, 'Books'),
('Incredible Headphones', 'High-quality headphones for immersive audio.', 79.99, 'Electronics');

CREATE TABLE customers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone_number VARCHAR(20),
    address TEXT
);

INSERT INTO customers (first_name, last_name, email, phone_number, address) VALUES
('Alice', 'Smith', 'alice.smith@example.com', '555-123-4567', '123 Main St'),
('Bob', 'Johnson', 'bob.johnson@example.com', '555-987-6543', '456 Oak Ave');

CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

INSERT INTO orders (customer_id, total_amount) VALUES
(1, 49.97),
(2, 89.98);

CREATE TABLE order_items (
    id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);

INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 1, 19.99),
(1, 2, 1, 9.99),
(1, 3, 1, 14.99),
(2, 4, 1, 79.99),
(2, 2, 1, 9.99);

-- Test for NULL value edge cases, constraints, and potential errors.
INSERT INTO products (name, price, category) VALUES ('Test Product with No Description', 5.00, 'Test');
INSERT INTO customers (first_name, last_name, email) VALUES ('No', 'Phone', 'nophone@test.com');
INSERT INTO orders (customer_id, total_amount) VALUES (1, -10.00); -- Testing negative amount, constraint violation.

-- MySQL specific features
SET @product_name = 'My Product';
SELECT * FROM products WHERE name LIKE CONCAT('%', @product_name, '%');

-- Window function example (MySQL 8.0+)
SELECT id, name, price, ROW_NUMBER() OVER (ORDER BY price DESC) AS row_num FROM products;

-- Spatial data type (requires MySQL version with spatial support, typically 5.7.6+)
CREATE TABLE spatial_data (id INT, geom GEOMETRY);
INSERT INTO spatial_data (id, geom) VALUES (1, ST_GeomFromText('POINT(1 1)'));
SELECT ST_AsText(geom) FROM spatial_data;

-- JSON data type example (MySQL 5.7+)
CREATE TABLE json_data (id INT, data JSON);
INSERT INTO json_data (id, data) VALUES (1, '{"name": "Test Object", "value": 123}');
SELECT data->>'$.name' FROM json_data;

-- ANALYZE TABLE
ANALYZE TABLE products, customers, orders, order_items, spatial_data, json_data;