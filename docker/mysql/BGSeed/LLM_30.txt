SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
SET GLOBAL innodb_default_row_format=dynamic;
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_product_name (product_name)
) ENGINE=InnoDB;

CREATE TABLE categories (
    category_id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(255) NOT NULL UNIQUE
) ENGINE=InnoDB;

CREATE TABLE product_categories (
    product_id INT,
    category_id INT,
    PRIMARY KEY (product_id, category_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id),
    FOREIGN KEY (category_id) REFERENCES categories(category_id)
) ENGINE=InnoDB;

INSERT INTO categories (category_name) VALUES ('Electronics'), ('Books'), ('Home Goods');

INSERT INTO products (product_name, description, price) VALUES
('Laptop', 'High-performance laptop', 1200.00),
('Novel', 'A thrilling novel', 15.99),
('Coffee Maker', 'Automatic coffee maker', 50.00);

INSERT INTO product_categories (product_id, category_id) VALUES
(1, 1),
(2, 2),
(3, 3);

-- MySQL-specific: Spatial data type example
CREATE TABLE locations (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255),
    location POINT SRID 4326
) ENGINE=InnoDB;

INSERT INTO locations (name, location) VALUES ('Office', ST_GeomFromText('POINT(10 20)', 4326));

-- MySQL-specific: JSON data type example
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT,
    order_date DATE,
    order_details JSON
) ENGINE=InnoDB;

INSERT INTO orders (customer_id, order_date, order_details) VALUES
(123, '2023-10-26', '{"items": [{"product": "Laptop", "quantity": 1}, {"product": "Mouse", "quantity": 1}]}');

-- Example of FULLTEXT index and search
ALTER TABLE products ADD FULLTEXT(product_name, description);
SELECT * FROM products WHERE MATCH (product_name, description) AGAINST ('laptop' IN NATURAL LANGUAGE MODE);

-- Example of using window function (MySQL 8+)
SELECT product_name, price, ROW_NUMBER() OVER (ORDER BY price DESC) as rank FROM products;

SHOW CREATE TABLE products;
SHOW CREATE TABLE categories;
SHOW CREATE TABLE product_categories;
SHOW CREATE TABLE locations;
SHOW CREATE TABLE orders;