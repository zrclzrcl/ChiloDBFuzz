SET NAMES utf8mb4;
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    quantity INT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    discount FLOAT NULL
);

INSERT INTO products (name, description, price, quantity) VALUES
('Awesome T-Shirt', 'A really awesome t-shirt.', 19.99, 50),
('Cool Mug', 'A cool mug for your favorite beverage.', 9.99, 100),
('Fancy Pen', 'A fancy pen for writing important things.', 4.99, 200),
('Amazing Book', 'An amazing book that will change your life.', 29.99, 25),
('Stylish Hat', 'A stylish hat to keep you looking good.', 14.99, 75);

ALTER TABLE products ADD FULLTEXT (name, description);

SELECT * FROM products WHERE MATCH (name, description) AGAINST ('awesome' IN NATURAL LANGUAGE MODE);

CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    total DECIMAL(10, 2) NOT NULL
);

CREATE TABLE order_items (
    id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);

INSERT INTO orders (customer_id, total) VALUES
(1, 49.97),
(2, 14.98),
(3, 34.97);

INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 1, 19.99),
(1, 2, 1, 9.99),
(1, 3, 2, 4.99),
(2, 4, 1, 14.99),
(3, 1, 1, 19.99),
(3, 3, 3, 4.99);

CREATE VIEW product_summary AS
SELECT
    p.name,
    SUM(oi.quantity) AS total_sold,
    AVG(oi.price) AS average_price
FROM
    products p
JOIN
    order_items oi ON p.id = oi.product_id
GROUP BY
    p.name;

SELECT * FROM product_summary;

-- Test case sensitivity for column names
SELECT pRoDuCtS.id from PRODUCTS;

-- Test JSON functions
SELECT JSON_OBJECT('id', id, 'name', name) AS product_json FROM products LIMIT 1;

-- Test spatial functions (requires spatial data types enabled, often not default but good to check error handling)
-- CREATE TABLE spatial_data (id INT, geom GEOMETRY); -- Commented out spatial table creation
-- INSERT INTO spatial_data VALUES (1, ST_GeomFromText('POINT(1 1)')); -- Commented out spatial data insert
-- SELECT ST_Distance(g1.geom, g2.geom) FROM spatial_data g1, spatial_data g2 WHERE g1.id = 1 AND g2.id = 1; -- Commented out spatial select