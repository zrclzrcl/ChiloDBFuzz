SET NAMES utf8mb4;
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    quantity INT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO products (name, description, price, quantity) VALUES
('Awesome T-Shirt', 'A comfortable and stylish t-shirt.', 19.99, 50),
('Cool Mug', 'Keeps your drinks hot or cold.', 9.99, 100),
('Fancy Notebook', 'Perfect for jotting down ideas.', 5.99, 75);

CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending'
);

INSERT INTO orders (customer_id, order_date, total_amount, status) VALUES
(1, '2023-10-26', 39.97, 'delivered'),
(2, '2023-10-27', 9.99, 'shipped'),
(1, '2023-10-28', 5.99, 'processing');

CREATE TABLE order_items (
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT UNSIGNED NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);

INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 2, 19.99),
(1, 2, 1, 9.99),
(2, 2, 1, 9.99),
(3, 3, 1, 5.99);

-- Demonstrating window functions, common to many but good for initial seeds
SELECT
    p.name,
    p.price,
    RANK() OVER (ORDER BY p.price DESC) AS price_rank
FROM
    products p;

-- Example of a stored procedure.
DELIMITER //
CREATE PROCEDURE GetProductCount(OUT total INT)
BEGIN
    SELECT COUNT(*) INTO total FROM products;
END //
DELIMITER ;

CALL GetProductCount(@product_count);
SELECT @product_count;

-- Example of using JSON functions (MySQL specific and good for fuzzing)
UPDATE products SET description = JSON_SET(description, '$.features', JSON_ARRAY('Durable', 'Stylish')) WHERE id = 1;
SELECT id, JSON_EXTRACT(description, '$.features') FROM products WHERE id = 1;

-- Example using fulltext indexes (MySQL specific)
ALTER TABLE products ADD FULLTEXT INDEX idx_name_description (name, description);
SELECT * FROM products WHERE MATCH (name, description) AGAINST ('T-Shirt');

-- Test with spatial data (MySQL specific).
CREATE TABLE places (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255),
  location POINT SRID 0
);
INSERT INTO places (name, location) VALUES ('Office', ST_GeomFromText('POINT(10 10)'));
SELECT ST_AsText(location) from places;