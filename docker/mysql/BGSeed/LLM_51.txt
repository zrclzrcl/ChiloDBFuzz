CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2)
);

INSERT INTO products (product_name, price) VALUES ('Laptop', 1200.00);
INSERT INTO products (product_name, price) VALUES ('Mouse', 25.00);
INSERT INTO products (product_name, price) VALUES ('Keyboard', 75.00);

CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE order_items (
    order_item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT,
    product_id INT,
    quantity INT,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);

INSERT INTO orders (customer_id) VALUES (123);
INSERT INTO order_items (order_id, product_id, quantity) VALUES (1, 1, 1);
INSERT INTO order_items (order_id, product_id, quantity) VALUES (1, 2, 2);

-- Test case for handling large quantity
INSERT INTO order_items (order_id, product_id, quantity) VALUES (1, 3, 2147483647);

-- Simulate a duplicate entry error (if unique key exists)
-- INSERT INTO products (product_name, price) VALUES ('Laptop', 1200.00);

-- Example using REPLACE INTO (if primary key or unique key exists, existing row is deleted first)
REPLACE INTO products (product_id, product_name, price) VALUES (1, 'Laptop (Updated)', 1250.00);

-- Example of ON DUPLICATE KEY UPDATE (requires unique index or primary key on the column being updated)
ALTER TABLE products ADD UNIQUE INDEX product_name_unique (product_name);
INSERT INTO products (product_name, price) VALUES ('Laptop (Updated)', 1300.00) ON DUPLICATE KEY UPDATE price = 1300.00;

-- Test adding a column with a default value
ALTER TABLE products ADD COLUMN description TEXT DEFAULT 'No description available';

-- Test fulltext search
ALTER TABLE products ADD FULLTEXT INDEX product_name_fulltext (product_name);
SELECT * FROM products WHERE MATCH (product_name) AGAINST ('Laptop');

-- Using window functions (requires MySQL 8.0+)
SELECT product_name, price, RANK() OVER (ORDER BY price DESC) AS price_rank FROM products;

-- Test JSON functions (requires MySQL 5.7+)
ALTER TABLE products ADD COLUMN attributes JSON;
UPDATE products SET attributes = '{"color": "black", "weight": 2.5}' WHERE product_id = 1;
SELECT product_name, JSON_EXTRACT(attributes, '$.color') AS color FROM products WHERE product_id = 1;