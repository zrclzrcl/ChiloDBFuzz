CREATE TABLE employees (
    id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    email VARCHAR(100) UNIQUE,
    phone_number VARCHAR(20),
    hire_date DATE,
    job_id INT,
    salary DECIMAL(10, 2),
    commission_pct DECIMAL(4, 2),
    manager_id INT,
    department_id INT
);

CREATE TABLE departments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) UNIQUE,
    location_id INT
);

CREATE TABLE jobs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(50) UNIQUE,
    min_salary DECIMAL(10, 2),
    max_salary DECIMAL(10, 2)
);

ALTER TABLE employees ADD FOREIGN KEY (job_id) REFERENCES jobs(id);
ALTER TABLE employees ADD FOREIGN KEY (department_id) REFERENCES departments(id);
ALTER TABLE employees ADD INDEX salary_index (salary);
ALTER TABLE departments ADD SPATIAL INDEX(location_id);

INSERT INTO jobs (title, min_salary, max_salary) VALUES
('Software Engineer', 60000, 150000),
('Data Scientist', 70000, 160000),
('Project Manager', 80000, 180000);

INSERT INTO departments (name, location_id) VALUES
('Engineering', 101),
('Data Science', 102),
('Management', 103);

INSERT INTO employees (first_name, last_name, email, phone_number, hire_date, job_id, salary, commission_pct, manager_id, department_id) VALUES
('John', 'Doe', 'john.doe@example.com', '123-456-7890', '2022-01-15', 1, 80000, 0.10, NULL, 1),
('Jane', 'Smith', 'jane.smith@example.com', '987-654-3210', '2022-02-20', 2, 90000, 0.15, 1, 2),
('Robert', 'Jones', 'robert.jones@example.com', '555-123-4567', '2022-03-10', 3, 100000, 0.20, 1, 3);

SELECT * FROM employees WHERE salary > 75000 ORDER BY last_name;
SELECT COUNT(*) FROM employees WHERE department_id = 1;
UPDATE employees SET salary = salary * 1.10 WHERE department_id = 1;

-- MySQL Specific Features
CREATE FUNCTION calculate_bonus (salary DECIMAL(10,2), commission DECIMAL(4,2))
RETURNS DECIMAL(10,2)
DETERMINISTIC
RETURN salary * commission;

SELECT first_name, last_name, calculate_bonus(salary, commission_pct) AS bonus FROM employees;

CREATE EVENT my_event
ON SCHEDULE EVERY 1 DAY
STARTS '2024-01-01 00:00:00'
DO
  UPDATE employees SET salary = salary * 1.01 WHERE department_id = 2;

-- Spatial Data Example
CREATE TABLE spatial_data (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255),
    location POINT SRID 0
);

INSERT INTO spatial_data (name, location) VALUES ('Office', ST_GeomFromText('POINT(10 10)'));
SELECT name, ST_AsText(location) FROM spatial_data;

-- Test with JSON data
CREATE TABLE json_data (
  id INT PRIMARY KEY AUTO_INCREMENT,
  data JSON
);

INSERT INTO json_data (data) VALUES ('{"name": "Product A", "price": 29.99, "features": ["durable", "reliable"]}');
SELECT data->'$.name', data->'$.price' FROM json_data;