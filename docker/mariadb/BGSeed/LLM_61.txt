SET @old_sql_mode=@@sql_mode;
SET sql_mode = 'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `email` varchar(100) DEFAULT NULL,
  `password` varchar(255) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  FULLTEXT KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `users` (`username`, `email`, `password`) VALUES
('testuser1', 'test1@example.com', 'password123'),
('testuser2', 'test2@example.com', 'securepass'),
('testuser3', NULL, 'hashed_password');

CREATE TABLE `products` (
  `product_id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `description` text DEFAULT NULL,
  `price` decimal(10,2) NOT NULL,
  `stock_quantity` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`product_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `products` (`name`, `description`, `price`, `stock_quantity`) VALUES
('Awesome Widget', 'A really useful widget.', 19.99, 50),
('Deluxe Gadget', 'The ultimate gadget experience.', 99.99, 10),
('Basic Thingamajig', NULL, 5.99, 100);

CREATE TABLE `orders` (
  `order_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `order_date` timestamp NOT NULL DEFAULT current_timestamp(),
  `total_amount` decimal(10,2) NOT NULL,
  `status` ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') NOT NULL DEFAULT 'pending',
  PRIMARY KEY (`order_id`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `orders` (`user_id`, `total_amount`, `status`) VALUES
(1, 39.98, 'processing'),
(2, 99.99, 'shipped'),
(1, 5.99, 'delivered');

-- Test JSON functionality (MariaDB specific)
ALTER TABLE products ADD COLUMN features JSON;
UPDATE products SET features = '{"color": "red", "weight": "1kg"}' WHERE product_id = 1;

-- Test sequences (MariaDB specific)
CREATE SEQUENCE my_sequence START WITH 100 INCREMENT BY 1;
SELECT SEQ_NEXTVAL(my_sequence);
SELECT SEQ_CURRVAL(my_sequence);

-- Spatial data types test (MariaDB specific)
CREATE TABLE `locations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `location` POINT NOT NULL,
  SPATIAL INDEX(location),
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4;

INSERT INTO `locations` (`name`, `location`) VALUES ('My Point', ST_GeomFromText('POINT(10 10)'));

-- Window function test
SELECT product_id, name, price,
       AVG(price) OVER (ORDER BY price) AS avg_price
FROM products;

SET sql_mode = @old_sql_mode;