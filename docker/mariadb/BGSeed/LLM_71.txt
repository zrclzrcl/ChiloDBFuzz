SET optimizer_switch='semijoin=on,materialization=on,firstmatch=on,loosescan=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=off';
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
CREATE TABLE t1 (
    id INT AUTO_INCREMENT PRIMARY KEY,
    idservice INT,
    clee VARCHAR(20) NOT NULL UNIQUE,
    flag ENUM('Y', 'N'),
    data TEXT NULL,
    ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO t1 (idservice, clee, flag, data) VALUES
(1, 'abc123def', 'Y', 'Some initial data for testing.'),
(2, 'ghi456jkl', 'N', 'More interesting data here.');

CREATE TABLE t2 (
    id INT AUTO_INCREMENT PRIMARY KEY,
    t1_id INT,
    value VARCHAR(255),
    FOREIGN KEY (t1_id) REFERENCES t1(id)
);

INSERT INTO t2 (t1_id, value) VALUES
(1, 'Related value for t1 record 1'),
(2, 'Another related value for t1 record 2');

ANALYZE TABLE t1, t2;

ALTER TABLE t1 ADD COLUMN new_column INT DEFAULT 0;

-- MariaDB specific: Sequences
CREATE SEQUENCE my_sequence START WITH 100 INCREMENT BY 5;
SELECT NEXT VALUE FOR my_sequence;

-- MariaDB specific: Virtual Columns
ALTER TABLE t1 ADD COLUMN virtual_col VARCHAR(30) AS (CONCAT(clee, ' - ', flag)) VIRTUAL;

-- MariaDB specific: Dynamic Columns
SET @dyncol = COLUMN_CREATE('name', 'John', 'age', 30);
SELECT COLUMN_GET(@dyncol, 'name' AS name, 'age' AS age);

-- Test partitioning
CREATE TABLE t3 (
    id INT,
    date_col DATE
)
PARTITION BY RANGE (YEAR(date_col)) (
    PARTITION p0 VALUES LESS THAN (2020),
    PARTITION p1 VALUES LESS THAN (2022),
    PARTITION p2 VALUES LESS THAN MAXVALUE
);

INSERT INTO t3 VALUES (1, '2019-01-01'), (2, '2021-05-05'), (3, '2023-12-31');

-- Test stored procedure
DELIMITER //
CREATE PROCEDURE simple_proc (IN in_val INT, OUT out_val INT)
BEGIN
    SET out_val = in_val * 2;
END //
DELIMITER ;

CALL simple_proc(5, @result);
SELECT @result;