SET @old_sql_mode=@@sql_mode;
SET sql_mode = 'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- Test case for spatial data types and functions
CREATE TABLE spatial_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    geom GEOMETRY
);

INSERT INTO spatial_test (geom) VALUES
(ST_GeomFromText('POINT(1 1)')),
(ST_GeomFromText('LINESTRING(0 0, 1 1, 2 1, 2 2)')),
(ST_GeomFromText('POLYGON((0 0, 0 3, 3 3, 3 0, 0 0))')),
(ST_GeomFromText('GEOMETRYCOLLECTION(POINT(1 1), LINESTRING(0 0, 1 1))'));

SELECT id, ST_AsText(geom) FROM spatial_test;
SELECT ST_Distance(ST_GeomFromText('POINT(0 0)'), geom) FROM spatial_test;
SELECT ST_Contains(ST_GeomFromText('POLYGON((0 0, 0 3, 3 3, 3 0, 0 0))'), geom) FROM spatial_test;

-- Test case for JSON data types and functions
CREATE TABLE json_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    data JSON
);

INSERT INTO json_test (data) VALUES
('{"name": "Alice", "age": 30, "city": "New York"}'),
('{"name": "Bob", "age": 25, "city": "Los Angeles"}'),
('{"items": [1, 2, 3], "price": 99.99}');

SELECT id, JSON_EXTRACT(data, '$.name') FROM json_test;
SELECT id, JSON_UNQUOTE(JSON_EXTRACT(data, '$.city')) FROM json_test;
UPDATE json_test SET data = JSON_SET(data, '$.age', 31) WHERE id = 1;
SELECT * FROM json_test;

-- Test case for window functions
CREATE TABLE window_test (
    category VARCHAR(20),
    value INT
);

INSERT INTO window_test (category, value) VALUES
('A', 10), ('A', 20), ('A', 30),
('B', 15), ('B', 25), ('B', 35);

SELECT category, value,
       ROW_NUMBER() OVER (PARTITION BY category ORDER BY value) AS row_num,
       SUM(value) OVER (PARTITION BY category) AS category_sum
FROM window_test;

-- Test case for stored procedures with error handling
DELIMITER //
CREATE PROCEDURE safe_divide(IN numerator INT, IN denominator INT, OUT result DECIMAL(10, 2))
BEGIN
    DECLARE division_result DECIMAL(10, 2);
    IF denominator = 0 THEN
        SET result = NULL;
    ELSE
        SET division_result = numerator / denominator;
        SET result = division_result;
    END IF;
END //
DELIMITER ;

CALL safe_divide(10, 2, @result);
SELECT @result;
CALL safe_divide(10, 0, @result);
SELECT @result;

-- Cleanup (optional, but good practice)
DROP PROCEDURE IF EXISTS safe_divide;
DROP TABLE IF EXISTS spatial_test;
DROP TABLE IF EXISTS json_test;
DROP TABLE IF EXISTS window_test;

SET sql_mode=@old_sql_mode;