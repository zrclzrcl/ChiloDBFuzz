CREATE TABLE employees (
    employee_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    salary DECIMAL(10, 2),
    department_id INT
);

CREATE TABLE departments (
    department_id INT PRIMARY KEY AUTO_INCREMENT,
    department_name VARCHAR(50),
    location VARCHAR(50)
);

-- Foreign Key Constraint
ALTER TABLE employees ADD CONSTRAINT fk_department
FOREIGN KEY (department_id) REFERENCES departments(department_id);

-- Insert initial data
INSERT INTO departments (department_name, location) VALUES
('Sales', 'New York'),
('Marketing', 'London'),
('Engineering', 'San Francisco');

INSERT INTO employees (first_name, last_name, salary, department_id) VALUES
('John', 'Doe', 60000.00, 1),
('Jane', 'Smith', 75000.00, 2),
('Peter', 'Jones', 90000.00, 3);

-- MariaDB specific feature: Virtual Columns
ALTER TABLE employees ADD COLUMN full_name VARCHAR(101) GENERATED ALWAYS AS (CONCAT(first_name, ' ', last_name)) VIRTUAL;

-- MariaDB specific feature: Sequence example
CREATE SEQUENCE seq_employee_id START WITH 1000 INCREMENT BY 1;

-- MariaDB Dynamic Columns usage (requires installing the plugin)
-- INSTALL SONAME 'ha_dynamic';
-- CREATE TABLE dynamic_table (id INT PRIMARY KEY, dyn_col MEDIUMBLOB);
-- INSERT INTO dynamic_table (id, dyn_col) VALUES (1, COLUMN_CREATE('name', 'Alice', 'age', 30));
-- SELECT COLUMN_GET(dyn_col, 'name' AS CHAR) FROM dynamic_table WHERE id = 1;

-- Test some edge cases
SELECT AVG(salary) FROM employees WHERE department_id IS NULL;
SELECT department_name FROM departments WHERE location LIKE '% %'; -- Look for spaces
SELECT * FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);
SELECT COALESCE(first_name, last_name, 'Unknown') FROM employees;