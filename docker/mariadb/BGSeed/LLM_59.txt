CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    quantity INT UNSIGNED NOT NULL DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO products (name, description, price, quantity) VALUES
('Awesome T-Shirt', 'A comfortable and stylish t-shirt.', 19.99, 50),
('Cool Mug', 'Keeps your drinks hot or cold.', 12.50, 100),
('Fancy Notebook', 'Perfect for jotting down ideas.', 8.75, 75),
('Ergonomic Mouse', 'Reduces strain on your wrist.', 25.00, 30);

CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_name VARCHAR(255) NOT NULL,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL
);

INSERT INTO orders (customer_name, order_date, total_amount) VALUES
('Alice Smith', '2023-11-01', 52.48),
('Bob Johnson', '2023-11-05', 25.00),
('Charlie Brown', '2023-11-10', 8.75);

CREATE TABLE order_items (
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT UNSIGNED NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    PRIMARY KEY (order_id, product_id)
);

INSERT INTO order_items (order_id, product_id, quantity, price) VALUES
(1, 1, 2, 19.99),
(1, 2, 1, 12.50),
(2, 4, 1, 25.00),
(3, 3, 1, 8.75);

-- MariaDB specific feature: Dynamic Columns
CREATE TABLE dynamic_data (
    id INT PRIMARY KEY AUTO_INCREMENT,
    entity_id INT NOT NULL,
    attributes MEDIUMBLOB
);

INSERT INTO dynamic_data (entity_id, attributes) VALUES
(1, COLUMN_CREATE('color', 'red', 'size', 'large')),
(2, COLUMN_CREATE('material', 'steel', 'weight', 1.5));

-- MariaDB specific: Virtual Columns

ALTER TABLE products ADD COLUMN discounted_price DECIMAL(10,2) AS (price * 0.9) VIRTUAL;

-- Test window functions (common but useful)
SELECT name, price, AVG(price) OVER () AS average_price FROM products;

-- Test JSON functions
SELECT JSON_OBJECT('name', 'test', 'value', 123);

SET @sql_notes = @@sql_notes;
SET sql_notes = 0;
DROP TABLE IF EXISTS t1;
SET sql_notes = @sql_notes;