CREATE TABLE IF NOT EXISTS users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(255) NOT NULL UNIQUE,
    email VARCHAR(255) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);

INSERT IGNORE INTO users (username, email) VALUES ('testuser1', 'test1@example.com'), ('testuser2', 'test2@example.com');
INSERT IGNORE INTO products (name, price) VALUES ('Product A', 19.99), ('Product B', 29.99);
INSERT IGNORE INTO orders (user_id, product_id, quantity) VALUES (1, 1, 2), (2, 2, 1);

-- MariaDB specific feature: Window function with IGNORE NULLS
SELECT
    username,
    email,
    ROW_NUMBER() OVER (ORDER BY username IGNORE NULLS) as row_num
FROM
    users;

-- MariaDB specific feature: Using JSON functions
SELECT JSON_OBJECT('id', id, 'username', username) AS user_json FROM users WHERE id = 1;

-- Test for out-of-range values
SELECT CAST('999999999999999999999999999999' AS UNSIGNED);

-- Test Division by zero
SELECT 1/0;

-- Test string comparison with different collations.
SELECT * FROM users WHERE username COLLATE utf8mb4_general_ci = 'testuser1' COLLATE utf8mb4_bin;