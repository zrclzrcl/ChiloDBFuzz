CREATE TABLE test_table (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    value INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO test_table (name, value) VALUES ('test1', 10);
INSERT INTO test_table (name, value) VALUES ('test2', 20);

SELECT * FROM test_table WHERE value > 15;

-- MariaDB specific syntax example: Window function with ignore nulls
SELECT name, value,
       ROW_NUMBER() OVER (ORDER BY value) AS row_num
FROM test_table;

-- MariaDB specific syntax example: RETURNING clause with INSERT
INSERT INTO test_table (name, value) VALUES ('test3', 30) RETURNING id, name, value;

-- MariaDB specific syntax example: JSON column support
ALTER TABLE test_table ADD COLUMN metadata JSON;

UPDATE test_table SET metadata = '{"key1": "value1", "key2": 123}' WHERE name = 'test1';

SELECT name, metadata->"$.key1" AS key1_value FROM test_table WHERE name = 'test1';

-- Create a stored procedure
DELIMITER //
CREATE PROCEDURE GetTableCount(OUT total INT)
BEGIN
    SELECT COUNT(*) INTO total FROM test_table;
END //
DELIMITER ;

CALL GetTableCount(@table_count);
SELECT @table_count;

-- Example of using a generated column
ALTER TABLE test_table ADD COLUMN name_length INT GENERATED ALWAYS AS (LENGTH(name)) STORED;

SELECT * FROM test_table;

DROP PROCEDURE IF EXISTS GetTableCount;
DROP TABLE IF EXISTS test_table;