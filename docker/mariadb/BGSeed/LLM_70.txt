CREATE TABLE employees (
    employee_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone_number VARCHAR(20),
    hire_date DATE NOT NULL,
    job_id INT,
    salary DECIMAL(10, 2),
    commission_pct DECIMAL(4, 2),
    manager_id INT,
    department_id INT
);

CREATE TABLE departments (
    department_id INT PRIMARY KEY AUTO_INCREMENT,
    department_name VARCHAR(50) NOT NULL,
    manager_id INT,
    location_id INT
);

CREATE TABLE jobs (
    job_id INT PRIMARY KEY AUTO_INCREMENT,
    job_title VARCHAR(50) NOT NULL,
    min_salary DECIMAL(10, 2),
    max_salary DECIMAL(10, 2)
);

INSERT INTO jobs (job_title, min_salary, max_salary) VALUES
('Software Engineer', 60000, 120000),
('Data Analyst', 55000, 110000),
('Project Manager', 70000, 140000),
('Sales Representative', 40000, 80000);

INSERT INTO departments (department_name) VALUES
('IT'),
('Marketing'),
('Sales'),
('Finance');

INSERT INTO employees (first_name, last_name, email, hire_date, job_id, salary, department_id) VALUES
('John', 'Doe', 'john.doe@example.com', '2022-01-15', 1, 80000, 1),
('Jane', 'Smith', 'jane.smith@example.com', '2022-03-01', 2, 70000, 2),
('Robert', 'Jones', 'robert.jones@example.com', '2022-05-10', 3, 90000, 1),
('Michael', 'Brown', 'michael.brown@example.com', '2022-07-22', 4, 60000, 3);

-- MariaDB Specific: Window function with IGNORE NULLS
SELECT
    first_name,
    salary,
    LAG(salary, 1, 0) IGNORE NULLS OVER (ORDER BY salary) AS previous_salary
FROM
    employees;

-- MariaDB Specific: Using SEQUENCE engine
CREATE TABLE seq_example (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT) ENGINE=SEQUENCE;
INSERT INTO seq_example () VALUES (), (), (), ();
SELECT * FROM seq_example;

-- Testing JSON functionality
ALTER TABLE employees ADD COLUMN json_data JSON;
UPDATE employees SET json_data = JSON_OBJECT('skills', JSON_ARRAY('SQL', 'Python'));

SELECT employee_id, JSON_EXTRACT(json_data, '$.skills[0]') AS skill1 FROM employees;

-- Testing stored procedure
DELIMITER //
CREATE PROCEDURE GetEmployeeCount(OUT total INT)
BEGIN
    SELECT COUNT(*) INTO total FROM employees;
END //
DELIMITER ;

CALL GetEmployeeCount(@employee_count);
SELECT @employee_count;

-- Testing Common Table Expression (CTE)
WITH HighSalaryEmployees AS (
    SELECT employee_id, first_name, salary
    FROM employees
    WHERE salary > 75000
)
SELECT * FROM HighSalaryEmployees;

-- Index Hints (MariaDB specific syntax might differ slightly)
SELECT * FROM employees USE INDEX (PRIMARY) WHERE employee_id = 1;

-- Optimizer Hints (Example: disabling index merge)
SELECT /*+ NO_MERGE(employees) */ * FROM employees WHERE employee_id = 1;

-- LOCK TABLES statement
LOCK TABLES employees READ;
-- UNLOCK TABLES statement
UNLOCK TABLES;

ANALYZE TABLE employees, departments, jobs;