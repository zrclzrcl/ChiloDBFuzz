<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChiloDisco Â· ç³»ç»Ÿè®¾ç½®</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Orbitron:wght@500;600&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css" />
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="/static/js/toast.js"></script>
</head>
<body>
  <canvas id="globalParticles"></canvas>
  <div id="app" class="layout">
    <aside class="sidenav">
      <div class="nav-brand">
        <span class="logo">âš¡</span>
        <span class="title">ChiloDisco</span>
      </div>
      <nav class="nav-links">
        <a href="/">æ—¥å¿—ç›‘æ§</a>
        <a href="/plot">æ•°æ®å¤§å±</a>
        <a href="/bitmap">Bitmap çƒ­åŠ›å›¾</a>
        <a href="/downloads">ç»“æœä¸‹è½½</a>
        <a class="active" href="/settings">ç³»ç»Ÿè®¾ç½®</a>
      </nav>
    </aside>

    <div class="content">
      <header class="app-header">
        <div class="brand">
          <span class="subtitle">âš™ï¸ ç³»ç»Ÿè®¾ç½®ä¸ä¸ªæ€§åŒ–é…ç½®</span>
        </div>
      </header>

      <main class="settings-container">
        <section class="settings-card">
          <div class="settings-header">
            <h2>ğŸ¨ è§†è§‰æ•ˆæœ</h2>
            <p>è°ƒæ•´ç•Œé¢åŠ¨ç”»å’Œè§†è§‰ç‰¹æ•ˆ</p>
          </div>
          <div class="settings-body">
            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">æ€§èƒ½æ¨¡å¼</label>
                <p class="setting-desc">å…³é—­æ‰€æœ‰åŠ¨ç”»å’Œç‰¹æ•ˆï¼Œæå‡æ€§èƒ½å’Œæµç•…åº¦</p>
              </div>
              <label class="switch">
                <input type="checkbox" v-model="performanceMode" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">ç²’å­ç‰¹æ•ˆ</label>
                <p class="setting-desc">èƒŒæ™¯ç²’å­åŠ¨ç”»ï¼ˆé«˜æ€§èƒ½æ¶ˆè€—ï¼‰</p>
              </div>
              <label class="switch">
                <input type="checkbox" v-model="particlesEnabled" :disabled="performanceMode" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">æ‰«æçº¿ç‰¹æ•ˆ</label>
                <p class="setting-desc">èµ›åšæœ‹å…‹é£æ ¼æ‰«æçº¿åŠ¨ç”»</p>
              </div>
              <label class="switch">
                <input type="checkbox" v-model="scanLinesEnabled" :disabled="performanceMode" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">å‘å…‰ç‰¹æ•ˆ</label>
                <p class="setting-desc">è¾¹æ¡†å’Œæ–‡å­—çš„éœ“è™¹å‘å…‰æ•ˆæœ</p>
              </div>
              <label class="switch">
                <input type="checkbox" v-model="glowEnabled" :disabled="performanceMode" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">å‘¼å¸åŠ¨ç”»</label>
                <p class="setting-desc">å¡ç‰‡å’ŒæŒ‰é’®çš„å‘¼å¸å‘å…‰åŠ¨ç”»</p>
              </div>
              <label class="switch">
                <input type="checkbox" v-model="breathingEnabled" :disabled="performanceMode" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </section>

        <section class="settings-card">
          <div class="settings-header">
            <h2>âš¡ æ€§èƒ½ç»Ÿè®¡</h2>
            <p>å®æ—¶æ€§èƒ½ç›‘æ§</p>
          </div>
          <div class="settings-body">
            <div class="stat-row">
              <span class="stat-label">FPSï¼ˆå¸§ç‡ï¼‰</span>
              <span class="stat-value">{{ fps }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">å†…å­˜ä½¿ç”¨</span>
              <span class="stat-value">{{ memoryUsage }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">åŠ¨ç”»æ•°é‡</span>
              <span class="stat-value">{{ animationCount }}</span>
            </div>
          </div>
        </section>

        <section class="settings-card">
          <div class="settings-header">
            <h2>âŒ¨ï¸ å¿«æ·é”®</h2>
            <p>é”®ç›˜å¿«æ·æ“ä½œ</p>
          </div>
          <div class="settings-body">
            <div class="shortcut-item">
              <kbd>Space</kbd>
              <span>æš‚åœ/ç»§ç»­åˆ·æ–°</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>F</kbd>
              <span>æœç´¢æ—¥å¿—</span>
            </div>
            <div class="shortcut-item">
              <kbd>Esc</kbd>
              <span>æ¸…é™¤æœç´¢</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>S</kbd>
              <span>æ‰“å¼€è®¾ç½®</span>
            </div>
            <div class="shortcut-item">
              <kbd>åŒå‡»æ—¥å¿—</kbd>
              <span>å¤åˆ¶å†…å®¹</span>
            </div>
          </div>
        </section>

        <section class="settings-card">
          <div class="settings-header">
            <h2>ğŸ’¾ æ•°æ®ç®¡ç†</h2>
            <p>ç¼“å­˜å’Œå­˜å‚¨ç®¡ç†</p>
          </div>
          <div class="settings-body">
            <button class="btn primary" @click="clearCache">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
            <button class="btn" @click="resetSettings">ğŸ”„ é‡ç½®æ‰€æœ‰è®¾ç½®</button>
            <button class="btn" @click="exportSettings">ğŸ“¥ å¯¼å‡ºé…ç½®</button>
            <button class="btn" @click="importSettings">ğŸ“¤ å¯¼å…¥é…ç½®</button>
          </div>
        </section>
      </main>

      <footer class="app-footer">
        <div class="legend">
          <span>æç¤ºï¼š</span>
          <span>è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</span>
        </div>
        <div class="copyright">Â© 2025 ChiloDisco</div>
      </footer>
    </div>
  </div>

  <script>
    const { createApp, ref, watch, onMounted, computed } = Vue;

    createApp({
      setup() {
        // ä» localStorage åŠ è½½è®¾ç½®
        const performanceMode = ref(localStorage.getItem('cd_performanceMode') === 'true');
        const particlesEnabled = ref(localStorage.getItem('cd_particles') !== 'false');
        const scanLinesEnabled = ref(localStorage.getItem('cd_scanLines') !== 'false');
        const glowEnabled = ref(localStorage.getItem('cd_glow') !== 'false');
        const breathingEnabled = ref(localStorage.getItem('cd_breathing') !== 'false');

        const fps = ref(60);
        const memoryUsage = ref('N/A');
        const animationCount = computed(() => {
          let count = 0;
          if (particlesEnabled.value) count += 80;
          if (scanLinesEnabled.value) count += 12;
          if (breathingEnabled.value) count += 6;
          return count;
        });

        // ç›‘å¬æ€§èƒ½æ¨¡å¼å˜åŒ–
        watch(performanceMode, (newVal) => {
          localStorage.setItem('cd_performanceMode', newVal);
          if (newVal) {
            // æ€§èƒ½æ¨¡å¼ï¼šå…³é—­æ‰€æœ‰ç‰¹æ•ˆ
            particlesEnabled.value = false;
            scanLinesEnabled.value = false;
            glowEnabled.value = false;
            breathingEnabled.value = false;
            applySettings();
          } else {
            // æ¢å¤é»˜è®¤
            particlesEnabled.value = true;
            scanLinesEnabled.value = true;
            glowEnabled.value = true;
            breathingEnabled.value = true;
            applySettings();
          }
        });

        // ç›‘å¬å„é¡¹è®¾ç½®å˜åŒ–
        watch([particlesEnabled, scanLinesEnabled, glowEnabled, breathingEnabled], ([p, s, g, b]) => {
          localStorage.setItem('cd_particles', p);
          localStorage.setItem('cd_scanLines', s);
          localStorage.setItem('cd_glow', g);
          localStorage.setItem('cd_breathing', b);
          applySettings();
        });

        function applySettings() {
          const root = document.documentElement;
          
          // ç²’å­ç‰¹æ•ˆ
          const canvas = document.getElementById('globalParticles');
          if (canvas) {
            canvas.style.display = particlesEnabled.value ? 'block' : 'none';
          }

          // æ‰«æçº¿ç‰¹æ•ˆ
          if (scanLinesEnabled.value) {
            root.style.setProperty('--scan-animation', 'scanLine 10s ease-in-out infinite');
          } else {
            root.style.setProperty('--scan-animation', 'none');
          }

          // å‘å…‰ç‰¹æ•ˆ
          if (!glowEnabled.value) {
            root.classList.add('no-glow');
          } else {
            root.classList.remove('no-glow');
          }

          // å‘¼å¸åŠ¨ç”»
          if (!breathingEnabled.value) {
            root.classList.add('no-breathing');
          } else {
            root.classList.remove('no-breathing');
          }
        }

        function clearCache() {
          sessionStorage.clear();
          window.ChiloDisco?.toast?.success('ç¼“å­˜å·²æ¸…é™¤ï¼');
        }

        function resetSettings() {
          if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿ')) {
            localStorage.removeItem('cd_performanceMode');
            localStorage.removeItem('cd_particles');
            localStorage.removeItem('cd_scanLines');
            localStorage.removeItem('cd_glow');
            localStorage.removeItem('cd_breathing');
            localStorage.removeItem('cd_interval');
            localStorage.removeItem('cd_maxLines');
            localStorage.removeItem('cd_plot_interval');
            window.ChiloDisco?.toast?.success('è®¾ç½®å·²é‡ç½®ï¼Œé¡µé¢å³å°†åˆ·æ–°...');
            setTimeout(() => location.reload(), 1000);
          }
        }

        function exportSettings() {
          const settings = {
            performanceMode: performanceMode.value,
            particles: particlesEnabled.value,
            scanLines: scanLinesEnabled.value,
            glow: glowEnabled.value,
            breathing: breathingEnabled.value,
            interval: localStorage.getItem('cd_interval'),
            maxLines: localStorage.getItem('cd_maxLines'),
          };
          const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'chilodisco_settings.json';
          a.click();
          URL.revokeObjectURL(url);
        }

        function importSettings() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const settings = JSON.parse(event.target.result);
                  performanceMode.value = settings.performanceMode ?? false;
                  particlesEnabled.value = settings.particles ?? true;
                  scanLinesEnabled.value = settings.scanLines ?? true;
                  glowEnabled.value = settings.glow ?? true;
                  breathingEnabled.value = settings.breathing ?? true;
                  if (settings.interval) localStorage.setItem('cd_interval', settings.interval);
                  if (settings.maxLines) localStorage.setItem('cd_maxLines', settings.maxLines);
                  window.ChiloDisco?.toast?.success('è®¾ç½®å·²å¯¼å…¥ï¼Œé¡µé¢å³å°†åˆ·æ–°...');
                  setTimeout(() => location.reload(), 1000);
                } catch (err) {
                  window.ChiloDisco?.toast?.error('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                }
              };
              reader.readAsText(file);
            }
          };
          input.click();
        }

        // FPS ç›‘æµ‹
        let lastTime = performance.now();
        let frames = 0;
        function measureFPS() {
          frames++;
          const now = performance.now();
          if (now >= lastTime + 1000) {
            fps.value = Math.round((frames * 1000) / (now - lastTime));
            frames = 0;
            lastTime = now;
          }
          requestAnimationFrame(measureFPS);
        }

        // å†…å­˜ç›‘æµ‹
        function measureMemory() {
          if (performance.memory) {
            const used = performance.memory.usedJSHeapSize;
            const total = performance.memory.totalJSHeapSize;
            memoryUsage.value = `${(used / 1024 / 1024).toFixed(1)} MB / ${(total / 1024 / 1024).toFixed(1)} MB`;
          }
        }

        onMounted(() => {
          applySettings();
          measureFPS();
          setInterval(measureMemory, 2000);
        });

        return {
          performanceMode,
          particlesEnabled,
          scanLinesEnabled,
          glowEnabled,
          breathingEnabled,
          fps,
          memoryUsage,
          animationCount,
          clearCache,
          resetSettings,
          exportSettings,
          importSettings
        };
      }
    }).mount('#app');

    // éœ“è™¹ç²’å­ç‰¹æ•ˆ
    (function() {
      const canvas = document.getElementById('globalParticles');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      
      const particles = [];
      const N = Math.max(80, Math.floor((canvas.width * canvas.height) / 8000));
      
      const colors = [
        { r: 0, g: 240, b: 255 },
        { r: 139, g: 92, b: 246 },
        { r: 255, g: 0, b: 110 },
        { r: 0, g: 255, b: 159 }
      ];
      
      for (let i = 0; i < N; i++) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: Math.random() * 2 + 1,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          color: color,
          alpha: Math.random() * 0.6 + 0.4,
          phase: Math.random() * Math.PI * 2,
          speed: Math.random() * 0.03 + 0.01
        });
      }
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        for (const p of particles) {
          p.x += p.vx;
          p.y += p.vy;
          p.phase += p.speed;
          
          if (p.x < -10) p.x = canvas.width + 10;
          if (p.x > canvas.width + 10) p.x = -10;
          if (p.y < -10) p.y = canvas.height + 10;
          if (p.y > canvas.height + 10) p.y = -10;
          
          const glow = 0.6 + 0.4 * Math.sin(p.phase);
          const glowRadius = p.r * 4 * glow;
          
          const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, glowRadius);
          grad.addColorStop(0, `rgba(${p.color.r}, ${p.color.g}, ${p.color.b}, ${p.alpha * glow})`);
          grad.addColorStop(0.4, `rgba(${p.color.r}, ${p.color.g}, ${p.color.b}, ${p.alpha * glow * 0.5})`);
          grad.addColorStop(1, `rgba(${p.color.r}, ${p.color.g}, ${p.color.b}, 0)`);
          
          ctx.fillStyle = grad;
          ctx.beginPath();
          ctx.arc(p.x, p.y, glowRadius, 0, Math.PI * 2);
          ctx.fill();
          
          ctx.fillStyle = `rgba(${p.color.r}, ${p.color.g}, ${p.color.b}, ${p.alpha * glow})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        }
        
        requestAnimationFrame(animate);
      }
      
      animate();
      window.addEventListener('resize', resize);
      
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    })();
  </script>
</body>
</html>

