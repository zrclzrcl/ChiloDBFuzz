import{_ as U,r as L,a as G,o as P,b as E,c as _,d as t,w as A,v as w,F,e as b,n as I,f as u,t as p,g as N}from"./index-DKzMqUOh.js";const S={class:"page-logs"},B={class:"page-header"},j={class:"controls"},C={class:"logs-grid"},V={class:"card-header"},$={class:"card-title"},q={class:"name"},z={class:"filename"},X={class:"meta"},J={class:"time"},K=["innerHTML"],Q={__name:"Logs",setup(W){const c=L(2e3),f=L(500),l=G([]);let d=null;const y={LLM_LOG_PATH:"LLM 交互",MAIN_LOG_PATH:"主进程",MUTATOR_FIXER_LOG_PATH:"修复器",MUTATOR_GENERATOR_LOG_PATH:"生成器",PARSER_LOG_PATH:"解析器",STRUCTURAL_MUTATOR_LOG_PATH:"结构变异"};function x(n){return y[n]||n}function H(n,e){let s="var(--text-muted)",a="none";e<5?(s="#fff",a="0 0 8px rgba(255,255,255,0.3)"):e<30&&(s="var(--text-secondary)");const h=n.replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o]);return`<div style="color:${s}; text-shadow:${a}">${h}</div>`}async function g(){try{const e=await(await fetch("/api/logs?t="+Date.now())).json(),s=new Date(e.now),a=Object.keys(e.logs).sort();l.length!==a.length&&l.splice(0,l.length,...a.map(o=>({key:o,html:"",filename:"",isFresh:!1})));for(let o=0;o<a.length;o++){const O=a[o],i=e.logs[O],r=l[o];r.filename=i.path.split(/[/\\]/).pop(),r.mtimeText=i.mtime?new Date(i.mtime).toLocaleTimeString():"-";const R=new Date(i.mtime),k=(s-R)/1e3;r.isFresh=k<5;const D=(i.lines||[]).map(m=>{let T=999;return m.t&&(T=(s-new Date(m.t))/1e3),H(m.s,T)}).join("");r.html=D}await I(),document.querySelectorAll(".log-content").forEach(o=>{o.scrollHeight-o.scrollTop-o.clientHeight<50&&(o.scrollTop=o.scrollHeight)})}catch(n){console.error(n)}}function M(){v(),d=setInterval(g,c.value),g()}function v(){d&&clearInterval(d)}return P(M),E(v),(n,e)=>(u(),_("div",S,[t("header",B,[e[4]||(e[4]=t("h1",null,"实时日志监控",-1)),t("div",j,[A(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"select-control"},[...e[2]||(e[2]=[t("option",{value:200},"0.2s",-1),t("option",{value:1e3},"1s",-1),t("option",{value:2e3},"2s",-1)])],512),[[w,c.value]]),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),class:"select-control"},[...e[3]||(e[3]=[t("option",{value:200},"200行",-1),t("option",{value:500},"500行",-1),t("option",{value:1e3},"1000行",-1)])],512),[[w,f.value]])])]),t("div",C,[(u(!0),_(F,null,b(l,s=>(u(),_("div",{key:s.key,class:"log-card"},[t("div",V,[t("div",$,[t("span",q,p(x(s.key)),1),t("span",z,p(s.filename),1)]),t("div",X,[t("span",{class:N(["status-dot",{active:s.isFresh}])},null,2),t("span",J,p(s.mtimeText),1)])]),t("div",{class:"log-content",ref_for:!0,ref:"logContainers"},[t("pre",{innerHTML:s.html},null,8,K)],512)]))),128))])]))}},tt=U(Q,[["__scopeId","data-v-bb194559"]]);export{tt as default};
